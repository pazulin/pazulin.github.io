<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>中医试药体会</title>
      <link href="/2021/03/05/try-med/"/>
      <url>/2021/03/05/try-med/</url>
      
        <content type="html"><![CDATA[<h2 id="下针行间-太冲"><a href="#下针行间-太冲" class="headerlink" title="下针行间,太冲"></a>下针行间,太冲</h2><p>左右脚下针这两个穴位, 左脚下位置对一点, 太冲行针试试,第二脚趾有反应,下针位置片了一点,但是附近都又酸胀感,  右脚下不好,没什么感觉.<br>下完后本来右协有点不舒服, 下完后确实好一点. 第二天, 左甲状腺附近的压痛感也好一些. 右甲状腺附近好一点,但是还是右压痛.</p><h2 id="四逆散"><a href="#四逆散" class="headerlink" title="四逆散"></a>四逆散</h2><p>最近天气冷,手脚都冷, 感觉有点冰, 可能各种问题的原因把.  但是想单独试试四逆散, 柴胡白芍枳实甘草各6g.吃完,今天下午,手终于不想之前那么冷.<br>脚穿袜子,鞋 ,可能不是很明显. 但没有脚很暖的感觉. 手确实是暖.</p>]]></content>
      
      
      <categories>
          
          <category> 中医 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 中医 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>frp 内网穿越</title>
      <link href="/2021/02/20/frp/"/>
      <url>/2021/02/20/frp/</url>
      
        <content type="html"><![CDATA[<p>不废话,直接上流程</p><h1 id="服务区端"><a href="#服务区端" class="headerlink" title="服务区端"></a>服务区端</h1><p>mt7621的cpu的一个路由器 ,跑mipsle的程序,</p><h1 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h1><p>这个客户端时一个wr703n的路由器, 用来做mqtt server , 跑mips程序,其中把web控制页面透过frp共享出去. 端口为80 .</p><p>frpc.ini</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[common]</span><br><span class="line">server_addr = xxx.xxx.com</span><br><span class="line">server_port = 7000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># decide if exit program when first login failed, otherwise continuous relogin to frps</span><br><span class="line"># default is true</span><br><span class="line">login_fail_exit = true</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># auth token</span><br><span class="line">token = xxxxxxxxxxxxx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#[ssh]</span><br><span class="line">#type = tcp</span><br><span class="line">#local_ip = 127.0.0.1</span><br><span class="line">#local_port = 22</span><br><span class="line">#remote_port = 6000</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[tai_web]</span><br><span class="line">type = http</span><br><span class="line">local_port = 80</span><br><span class="line">privilege_mode = true</span><br><span class="line">custom_domains = abc.abc.com</span><br></pre></td></tr></table></figure><p>custom_domains = abc.abc.com  这个域名必须域名解析器加上,让其解析到 服务器ip,或者服务器的域名.</p><p>下面自启动进程 </p><p>必须先安装 nohup</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">opkg update</span><br><span class="line">opkg install coreutils-nohup</span><br></pre></td></tr></table></figure><p>增加下面这个文件</p><p>/etc/init.d/frpc</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh /etc/rc.common</span><br><span class="line"># Copyright (C) 2006-2011 OpenWrt.org</span><br><span class="line"></span><br><span class="line">START=99</span><br><span class="line"></span><br><span class="line">start() &#123;</span><br><span class="line">        sleep 60; nohup  /root/frp_0.35.1_linux_mips/frpc -c  /root/frp_0.35.1_linux_mips/frpc.ini &gt;/tmp/nohup.out 2&gt;&amp;1 &amp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stop() &#123;</span><br><span class="line">        kill -9 `ps | grep &apos;/root/frp_0.35.1_linux_mips/frpc&apos; | grep -v &apos;grep&apos; | awk &apos;&#123;print $1&#125;&apos;`</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在/etc/rc.d/ 增加一个链接文件</p><p>ln -s /etc/init.d/frpc /etc/rc.d/S99frpc</p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>跟施老师学经方心得</title>
      <link href="/2021/01/25/xinde/"/>
      <url>/2021/01/25/xinde/</url>
      
        <content type="html"><![CDATA[<h1 id="缘起"><a href="#缘起" class="headerlink" title="缘起"></a>缘起</h1><p>我少年时崇尚科学,不肖那些没有根据,玄之又玄的东西. 读书工作都是理工类, 后来偶然看到南怀瑾老师的书,为我打开一扇大门, 发现中华文化之美. 曾经想学道学庄子学佛. 中医是中华文化一部分,自然也想了解一点. 然后因为一些中医养生节目,更加激起自己兴趣, 所以2012年就自学起伤寒论. 不过各种原因, 最后放弃.</p><p>2年前,自己出现一次严重发烧胸痛,病拖了很久,一直没好,看了几个中医,有些情况好一些,有些却更糟糕. 于是索性就重新翻看以前的中医资料,找到倪老师,进而找到施老师. 于是就报名学. </p><h1 id="未见其人-先闻其声"><a href="#未见其人-先闻其声" class="headerlink" title="未见其人,先闻其声"></a>未见其人,先闻其声</h1><p>课程开始都是网课,只听见老师声音, 但是从诊断学的头一两节课起,就觉得与我之前看那些中医视频完全不同感受. 第一次听见有人是这么解释阴阳的, 而且,老师是理工科出身, 对于我们也是学理工的人来说,真的是太对胃口了. 以前最烦那些五行生克, 觉得这些东西都是有需要的时候就挑相生的这个路径来解释 ,有时候呢,就挑相克路径来解释,都没有一个通用规则. 也许这样也有明医,但是这样对人要求太高了,要非常聪明,悟性极高之人才能学好,否则,可能就是庸医. 但是中医要传承下去, 要医病救人,总不能要求每个都是聪明绝顶的人吧? 老师的中医课程打破这些, 很少讲那些玄之又玄东西, 全都是可以看到,可以问到,可以摸到的实际表现,这让普通人,只要用功都可以学.可操作性非常强. </p><p>老师经常开玩笑,说睡不着的时候拿录音档来听,当催眠.但是我没有这种感觉,课程内容密度很大,大脑都是要开足功率来听,怎么可以当催眠? 有时候老师一股劲就在哪里说,我都没反应过来,就说完了, 经常在这种时候,老师会说:”讲得太快啊,再说一次”. 内容密度很大,经常要听一下,暂停一下然后记下来. </p><p>学药证的时候,要尝药,每一个药品都要试,体会其中的气,味. 这必然都是老师当时学习时候切身体会,觉得这样学才比较好.确实也是, 尝过药后,的确比较容易记住药的特性, 要记住一个药,如果单单文字性的东西是很难记住的,有了气味,看见实物, 五官调动起来,比较容易记住这个药,也容易联想起来.</p><p>经过诊断学,药证学,再看汤证学, 发现了一个看伤寒论汤方的全新的理解视角,以前自学的时候,看&lt;刘渡舟伤寒论讲稿&gt;,看刘老医师,胡希恕解释汤方,也许资质有限,总不能理解. 现在经过老师前面课程,再看汤证学,顿时有一感觉: 原来汤方是这样的. 结合起诊断学,药证学,理解汤方就顺理成章, 也容易记下来,也容易理解其中的加减变化原则. 对比起之前自学时候状态,真有豁然一亮之感.</p><p>想想伤寒论中的条文,不都是这种辨证论治的思路吗?不都是这些出现什么症状,给什么方,出现什么症状,加某个药或者去某个药, 老师的课程把这些都具体化,细化,系统化, 让初学者迅速入门. 历史上那么多人注解伤寒论,大多都是逐句解释, 哪有这么系统化,细化 . 将来这套东西也必然在伤寒论传承史上留下印记.</p><h1 id="感恩"><a href="#感恩" class="headerlink" title="感恩"></a>感恩</h1><p>国庆期间线下课, 第一次见到老师. 不知道为何, 比起讲药讲诊断, 更喜欢听老师在那里乱扯,讲故事,讲东讲西,讲修行.而且听老师讲这些时候,老是唤起我以前读南怀瑾老师书时候的一些感受. 几次想跑上去问问老师入定后是什么体会,怎么看虚云大和尚那些神奇的遭遇.</p><p>老师说把自己会都毫无保留教给我们,这点我完全相信. 就看有时候我们问问题水平能去到哪里,问题水平高,越能激发老师讲的更细更深. 最近群里面得一些练习, 让我们有难得实践机会,只有拿出来用才能真学会,就像学一门编程语言,一边用一边学 ,这样是最快学会方法. 纸上谈兵是永远学不会得. 同学不断问,老师不断回答,真的由衷感谢老师不厌其烦的耐心回答. </p><p>老师老说素食,少吃鱼肉奶蛋.听得我耳朵都起茧,听了一两次,我就改过来素食,这不很简单吗?老师怎么老说这个,对我来说青菜豆腐都可以吃得有滋有味, 原来很多人难做到,跟诊的时候一位病人诉苦,说天天素食,没有吃过一口好的. 我心里想:完蛋,病肯定好不了. 身心不一,这相佐的情绪不好, 就算病给治好,过不了多久就再犯.这就是老师口中的业力. 素食这个问题,就算自己的亲人也不会一定听你的劝谏. 对于自己病,气滞痰阻的体质,如果没有跟老师学中医,没有老师叮咛,继续原来习惯,再过几年,不知会变得怎样不可收拾.</p><p>真的很感谢老师,感谢两位这么好助教,感恩这么一班志趣相投同学, 报名跟老师学中医, 是我近年最正确的决定,没有之一. 比起适当时候买房,比起赚钱升职加薪,更让我欣喜,也许…也许是孤独的小船黑夜中看见灯塔之故.</p>]]></content>
      
      
      <categories>
          
          <category> 中医 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 中医 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>神迹</title>
      <link href="/2020/12/24/shenji1/"/>
      <url>/2020/12/24/shenji1/</url>
      
        <content type="html"><![CDATA[<p>神迹<br>东势王朝倒塌后第三天，救难人员从扭曲变形的钢筋水泥中，救出钟永祥先生，被困数十个小时，重见天日的那一刻，他不仅神情镇定，身体状况仍十分良好;更令人惊讶的是：他并没有灰头土脸，甚至还可以称得上是相当“干净”!钟先生被救出后，他告诉大家一段遭遇，这件事传出后，众人莫不啧啧称奇。</p><p>故事得从钟先生一位远亲来访谈起。钟先生是广东人，他的亲戚远道来台探亲，身为主人的，当然热情款待。几天后，远亲整装离台，临行前，除了感谢之外，还特别告诉钟先生：“你们家的客房很清凉，睡起来好舒服，有时你也可以睡睡看。”</p><p>钟先生平常都睡在主卧室，那天钟太太到台中看儿子，他想起远亲的那番话，于是当晚便改睡在客房。</p><p>睡眠正甜时，突然大地一阵撼动。钟先生家住六楼，他感觉家里似乎向下坠落，真乎?梦乎?房屋四壁好像被什么东西挤压，就快碎裂般。</p><p>可是刹那间，他看见好几个全身散发金色、而且光头的人，用手撑住他头顶上那片即将倾倒的墙，同时，又有几个人压在他身上，感觉好像是在护著他的身体一般。</p><p>他心想：“三更半夜，为什么有这么多人在我房间?”猛然回神，发现四处漆黑，他问：“你们是什么人?”用手挥动，却发现杳无人迹。</p><p>这时，他摸摸身旁，吓了一跳，墙壁倾斜，他正处在中间的小空隙中。由于平日笃信佛法，钟先生马上想到：“刚刚一定是菩萨来救我!”于是端坐起来，就在墙与地之间的小缝中专心念佛。</p><p>三天过去，如果一般人陷于瓦砾中，必定觉得度日如年，身心逼恼。但是钟先生说：“我只有一心念佛、念观世音菩萨的名号，全然不管身在何处，反倒觉得自己很快就被救出来了。”</p><p>被救出后，钟先生才知道，东势王朝五楼以下陷落坍平，六楼变成一楼，而他家除了客房一角仍有空隙外，其他房间早已挤成一团。</p><p>同样是东势灾民的刘春珠师姐听说钟先生的事迹后，她特地去拜访。之前，她就风闻钟先生为人乐善好施，是一位医术高明的中医师，也专精针灸，平常若有贫穷患者求诊，他就分文不收。</p><p>刘师姐到钟先生的诊所，说明来意，钟先生知道她也是佛弟子，就告诉她更多奇迹。钟先生的诊所是一栋四楼建筑，四楼是佛堂，供奉三尊佛像，有释迦世尊及观世音菩萨，都是瓷器所造。地震后，佛像震落地上，不可思议，竟完好如初。</p><p>一、二、三楼都有书柜，奇特的事情发生了。钟先生行医多年，略有积蓄，在两岸开放探亲后，他重返广东故居，听人说某古寺倾倒荒废，他便独力资助寺院重建，此寺名为“绵洋寺”(位于福建省)。寺院落成时，他拍了许多照片当做纪念，这些照片就分别贴在书柜的玻璃上。</p><p>钟先生告诉刘师姐：“所有书柜材质一模一样，地震时所有的书柜倒了一地，但是，只要是贴著绵洋寺照片的柜子，完全没事，其他的柜子，玻璃碎落一地。”</p><p>这次大地震，钟永祥先生见证了佛菩萨的神迹，他说：感谢佛菩萨保佑，今后要更努力行善!</p>]]></content>
      
      
      <categories>
          
          <category> 寓言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 寓言 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>寓言</title>
      <link href="/2020/12/10/story-shy/"/>
      <url>/2020/12/10/story-shy/</url>
      
        <content type="html"><![CDATA[<p>来自 <a href="http://loveheal.org/phpbb3/viewforum.php?f=6" target="_blank" rel="noopener">http://loveheal.org/phpbb3/viewforum.php?f=6</a></p><h1 id="馬雅（Maya）的奧秘-～這是一個印度的神話，寓意深遠。"><a href="#馬雅（Maya）的奧秘-～這是一個印度的神話，寓意深遠。" class="headerlink" title="馬雅（Maya）的奧秘 ～這是一個印度的神話，寓意深遠。"></a>馬雅（Maya）的奧秘 ～這是一個印度的神話，寓意深遠。</h1><p>這是一個印度的神話。那拉達是一位專司音樂的半仙，祂愛管閒事，喜歡到處旅行，替天界的神明傳閒話。</p><p>那拉達急於知道毘濕努神（Vishinu）的「馬雅」奧秘，於是祂來到昆濕努神歇息的樹林中。打過招呼之後，那拉達詢問這位象徵藍色大海的神祇有關祂的馬雅奧祕。『馬雅』指的是蒙蔽世人的幻覺之王。</p><p>昆濕努神答應告訴那拉達這個奧祕，但是祂覺得口渴，祂希望那拉達能替他取點水來喝。那拉達進入森林想找一個有水的人家。過了不久祂來到一棟房子面前。祂敲了敲門，一位非常美麗的少女前來開門。她面帶微笑，用她那對如蓮的大眼看著祂，接著就轉過身去取水。那拉達迷上了這位少女，祂在牠的家中一待就是好幾天。</p><p>時間很快便過去了，那拉達和祂所愛的人結成夫妻，並且生了幾個小孩。那拉達和妻小生活得非常快樂。有一年大雨下個不停，洪水淹沒了兩岸，沖走了那拉達的家和附近的樹木。祂一手抓著妻子，一手抓著孩子，肩膀上還扛著另一個小孩。那拉達涉水尋找躲避的高地，但是不久洪水就淹沒了祂的胸膛和下巴。祂的孩子一個一個被洪水沖走，只有妻子還在身邊。黑夜的來臨更增加了祂心中的恐懼，洪水仍然繼繽高漲，最後祂的妻子也抓不住祂，被洪水淹沒。在孤單無助的情況下，祂舉起雙手向神明求援，突然有一個聲音從空中傳來：「十分鐘已經過去了，我的那杯水到底在哪裏啊？」</p><p>編者註：</p><p>馬雅（Maya）在佛教的語言中，就是由眾生共業所交織而成的業力。</p><p>在我們中國的道家哲理故事中，也有同樣的故事；例如「黃梁一夢」與「南柯一夢」的故事都有相同的寓意。</p><p>在我們的一生將要結束的最後一刻，希望你可以想起這個充滿智慧的故事。</p><h1 id="一袋寶石～蘇菲教派的寓言故事～"><a href="#一袋寶石～蘇菲教派的寓言故事～" class="headerlink" title="一袋寶石～蘇菲教派的寓言故事～"></a>一袋寶石～蘇菲教派的寓言故事～</h1><p>早上一大早，太陽還沒有出來，一個漁夫到了河邊，在岸上他感覺到有什麼東西在他的腳下，後來找出來是一小袋的石頭。他撿起袋子，將漁網放在一旁，坐在岸邊等待日出。</p><p>他在等待黎明，以便開始一天的工作，他懶洋洋地從袋子裡拿出一塊石頭丟進水裡。沒有其他事可做，他繼續把石頭一塊一塊丟進水裡。</p><p>慢慢地，太陽升起，大地重現光明，這時除了一塊石頭之外其他的石頭都丟光了，最後一塊石頭在他的手裡。當他藉著白天的光看到了他手中所拿的東酉時，他的心跳幾乎都要停止了，那是一顆寶石！在黑暗中，他把整裝的寶石都丟光了！在不知不覺當中，他的損失有多少！他充滿懊悔，咒罵他自己，很傷心地哭得幾乎失去理智。</p><p>他在無意間碰到的財富足夠豐富他的生活好幾倍，然而在不知不覺當中，在黑暗中，他又把它丟掉了。但是就某方面來講，他還是幸運的﹍還有一顆寶石留下來，在他將那顆寶石丟掉之前，天己經亮了。一般來講，大多數的人甚至還沒有那麼幸運。</p><p>周圍一片漆黑，而時間又過得很快，太陽尚未升起我們就己經浪費掉所有生命中的寶石。生命是一個大的寶庫，人類沒有好好利用它，只是白白地將它浪費掉，等到我們知道了生命的重要性時，我們已經將時光消磨殆盡。生活的秘密、奧秘、快樂、解脫、慈悲、智慧……，一切都丟盡了，而一個人的一生就這樣過去了。</p><h1 id="抓猴子的方法"><a href="#抓猴子的方法" class="headerlink" title="抓猴子的方法"></a>抓猴子的方法</h1><p>抓猴子的方法</p><p>有一隻猴子在樹上玩耍嬉戲，突然，牠看到了樹下有一個看起來很好吃的櫻桃，於是牠就從樹上下來，牠發現了這個櫻桃是在一個很大的玻璃瓶裡面。</p><p>這個玻璃平的瓶口很窄小，恰好猴子的手可以伸進去，於是猴子用手伸進去抓住了這個好吃的櫻桃，可是牠的手因為握住了櫻桃，所以沒有辦法從窄小的瓶口伸出來。</p><p>此時獵人從遠處從容地走過來，猴子還是不知道應該把手中的櫻桃放開，於是就被獵人給抓住了。</p><p>　</p><p>附註：我們是不是也常常為了眼前小小的利益，忘了人生更重要的目標呢？</p><h1 id="莊嚴的寺廟～美的奧秘～"><a href="#莊嚴的寺廟～美的奧秘～" class="headerlink" title="莊嚴的寺廟～美的奧秘～"></a>莊嚴的寺廟～美的奧秘～</h1><p>有一個皇帝想要整修在京城裡的一座寺廟，他派人去找技藝高超的設計師，希望能夠將寺廟整修成美麗而又莊嚴。</p><p>後來有兩組人員被找來了，其中一組是京城裡很有名的工匠與畫師，另外一組是幾個和尚。由於皇帝沒有辦法決定到底哪一組人員的的手藝比較好，於是他就決定要給他們機會作一個比較。</p><p>皇帝要求這兩組人員，各自去整修一個小寺廟，而這兩個寺廟互相面對面；三天之後，皇帝要來驗收成果。</p><p>工匠們向皇帝要了一百多種顏色的顏料（漆），又要求了很多的工具；而讓皇帝很奇怪的是，和尚們居然只要了一些抹布與水桶等等簡單的清潔用具。</p><p>三天之後，皇帝來驗收兩組人員裝修寺廟的結果，他首先看看工匠們所裝飾的寺廟，工匠們敲鑼打鼓地慶祝著工程的完成，他們用了非常多的顏料，以非常精巧的手藝把寺廟裝飾得五顏六色。皇帝很滿意地點點頭，接著回過頭來看看和尚們負責整修的寺廟，他一看之下就愣住了，和尚們所整修的寺廟沒有塗上任何的顏料，他們只是把所有的牆壁、桌椅、窗戶等等都擦拭的非常乾淨，寺廟中所有的物品都顯現出了它們原來的顏色，而它們光澤的表面就像鏡子一般，無瑕地反射出從外面而來的色彩，那天邊多變的雲彩、隨風搖曳的樹影，甚至是對面五顏六色的寺廟，都變成了這個寺廟美麗色彩的一部份，而這座寺廟只是寧靜地接受這一切。</p><p>皇帝被這莊嚴的寺廟深深地感動了，當然我們也知道最後的勝負了。</p><p>　</p><p>筆者註：<br>我們的心就像是一座寺廟，我們不需要用各種精巧的裝飾來美化我們的心靈，我們需要的只是讓內在原有的美，無瑕地顯現出來。</p><h1 id="慾望的鎖鍊～發生在我們周遭的故事～"><a href="#慾望的鎖鍊～發生在我們周遭的故事～" class="headerlink" title="慾望的鎖鍊～發生在我們周遭的故事～"></a>慾望的鎖鍊～發生在我們周遭的故事～</h1><p>有一位禁欲苦行的修道者，準備離開他所住的村莊，到無人居住的山中去隱居修行，他只帶了一塊布當作衣服，就一個人到山中居住了。</p><p>後來他想到當他要洗衣服的時候，他需要另外一塊布來替換，於是他就下山到村莊中，向村民們乞討一塊布當作衣服，村民們都知道他是虔誠的修道者，於是毫不考慮地就給了他一塊布，當作換洗用的衣服。</p><p>當這位修道者回到山中之後，他發覺在他居住的茅屋裡面有一隻老鼠，常常會在他專心打坐的時候來咬他那件準備換洗的衣服，他早就發誓一生遵守不殺生的戒律，因此他不願意去傷害那隻老鼠，但是他又沒有辦法趕走那隻老鼠，所以他回到村莊中，向村民要一隻貓來飼養。</p><p>得到了一隻貓之後，他又想到了─『貓要吃什麼呢？我並不想讓貓去吃老鼠，但總不能跟我一樣只吃一些水果與野菜吧！』，於是他又向村民要了一隻乳牛，這樣子那隻貓就可以靠牛奶維生。</p><p>但是，在山中居住了一段時間以後，他發覺每天都要花很多的時間來照顧那隻母牛，於是他又回到村莊中，他找到了一個可憐流浪漢，於是就帶這無家可歸的流浪漢到山中居住，幫他照顧乳牛。</p><p>那個流浪漢在山中居住了一段時間之後，他跟修道者抱怨說：「我跟你不一樣，我需要一個太太，我要正常的家庭生活。」修道者想一想也是有道理，他不能強迫別人一定要跟他一樣，過著禁欲苦行的生活……….</p><p>這個故事就這樣繼續演變下去，你可能也猜到了，到了後來，也許是半年以後，整個村莊都搬到山上去了。</p>]]></content>
      
      
      <categories>
          
          <category> 寓言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 寓言 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>中医一些观点</title>
      <link href="/2020/12/04/learntm/"/>
      <url>/2020/12/04/learntm/</url>
      
        <content type="html"><![CDATA[<p>下面这些内容来自 <a href="http://loveheal.org/" target="_blank" rel="noopener">http://loveheal.org/</a> 我的老师施合一. 我引用过来是怕自己忘记了.</p><h1 id="关于糖"><a href="#关于糖" class="headerlink" title="关于糖"></a>关于糖</h1><p>中醫觀點：<br>請大家到原來引用的網址去看這位女士的圖片，的確臉色變亮了（也許有人會說臉色可以用修圖軟體改變）、眼袋明顯縮小了。<br>中醫認為，飲食方面應該五味均衡、清淡，不宜偏重一味；但現代人常常太偏重辛辣、或甜味、或酸甜，偏重各種口味都會有不同的副作用，以後會再說明。<br>此處只討論甜味(中醫稱為甘味)，天然的甜味，例如甘蔗汁，可以潤肺養脾胃，曾經有一位初期糖尿病患的女患者，因為其他不舒服症狀來看診，她檢查到有血糖過高、有糖尿病的時候，她聽說甘蔗汁可以治療消渴證，於是每天喝甘蔗汁一個月(每天喝的量我忘記了，抱歉..)，各位讀者猜結果如何？結果一個月後血糖下降，真的糖尿病症狀改善了。如果各位讀者每天吃精製糖、白糖做成的甜點、甜的飲料等等，請問是否糖尿病症狀會改善？答案是否定的，應該會加重，而且會有容易胃酸過多、脂肪堆積等等問題產生。為什麼甘蔗汁、天然的紅糖與精製糖不一樣呢？天然的甘蔗汁帶有一點酸澀的味道是白糖沒有的，而酸澀的味道是養陰的，這就是甘蔗汁與精製白糖的不同。所以筆者才會提倡，如果要吃甜味的食物或飲料，請確認要用天然的甘蔗汁、或天然紅糖、黑糖、天然蜂蜜等。<br>不過，天然的甜味也不是吃越多越好；首先，中醫認為甘能令人中滿，吃太甜，容易有胃部脹滿、胃酸過多的問題；<br>其次，甘味能益脾陽，但脾陽過亢則容易損傷脾陰，例如小孩子甜食吃多會亢奮、過動，這是陽太亢的現象，而大人甜食吃多，會導致容易口渴、餓的時候氣虛乏力的消渴現象，這是第二個問題；第三，吃太甜容易在體內累積濕氣，導致脂肪堆積、身體沈重、血脈運行不暢等問題；第四，甜的食物或飲料吃太多，脾土過亢則剋腎水，使得小孩子可能過動之外，也容易骨骼發育不良，腦部發育遲緩，家長不可不慎。<br>結論就是，天然的甜味食物，適量有益於健康，但過量則不宜。至於精製糖、人工糖、果糖、化學糖精等等，就盡量避免；<br>否則就可能導致糖尿病、胃酸過多、火燒心、過動、發育遲緩、智力減退等問題。</p>]]></content>
      
      
      <categories>
          
          <category> 中医 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 中医 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>小河流的旅程</title>
      <link href="/2020/09/27/river/"/>
      <url>/2020/09/27/river/</url>
      
        <content type="html"><![CDATA[<p>来自 <a href="http://loveheal.org/phpbb3/viewtopic.php?f=6&amp;t=7" target="_blank" rel="noopener">http://loveheal.org/phpbb3/viewtopic.php?f=6&amp;t=7</a></p><p>小河流的旅程</p><p>有一條小河流從遙遠的高山上流下來，經過了很多個村莊與森林，最後它來到了一個沙漠。它想：「我已經越過了重重的障礙，這次應該也可以越過這個沙漠吧！」</p><p>當它決定越過這個沙漠的時候，它發現它的河水漸漸消失在泥沙當中，它試了一次又一次，總是徒勞無功，於是它灰心了，「也許這就是我的命運了，我永遠也到不了傳說中那個浩瀚的大海。」它頹喪地自言自語。</p><p>這時候，四周響起了一陣低沈的聲音，「如果微風可以跨越沙漠，那麼河流也可以。」原來這是沙漠發出的聲音。</p><p>小河流很不服氣地回答說：「那是因為微風可以飛過沙漠，可是我卻不行。」</p><p>「因為你堅持你原來的樣子，所以你永遠無法跨越這個沙漠。你必須讓微風帶著你飛過這個沙漠，到你的目的地。只要願意你放棄你現在的樣子，讓自己蒸發到微風中。」沙漠用它低沈的聲音這麼說。</p><p>小河流從來不知道有這樣的事情，「放棄我現在的樣子，然後消失在微風中？不！不！」小河流無法接受這樣的概念，畢竟它從未有這樣的經驗，叫它放棄自己現在的樣子，那麼不等於是自我毀滅了嗎？「我怎麼知道這是真的？」小河流這麼問。</p><p>「微風可以把水氣包含在它之中，然後飄過沙漠，到了適當的地點，它就把這些水氣釋放出來，於是就變成了雨水。然後這些雨水又會形成河流，繼續向前進。」沙漠很有耐心地回答。</p><p>「那我還是原來的河流嗎？」小河流問。</p><p>「可以說是，也可以說不是。」沙漠回答。「不管你是一條河流或是看不見的水蒸氣，你內在的本質從來沒有改變。你會堅持你是一條河流，是因為你從來不知道自己內在的本質。」</p><p>此時小河流的心中，隱隱約約地想起了似乎自己在變成河流之前，似乎也是由微風帶著自己，飛到內陸某座高山的半山腰，然後變成雨水落下，才變成今日的河流。</p><p>於是小河流終於鼓起勇氣，投入微風張開的雙臂，消失在微風之中，讓微風帶著它，奔向它生命中（某個階段）的歸宿。</p><p>　</p><p>附註：</p><p>我們的生命歷程往往也像小河流一樣，想要跨越生命中的障礙，達成某種程度的突破，往真善美的目標邁進，也需要有「放下自我」的勇氣，邁向未知的領域。</p><p>2012/12/09 後記：<br>這個故事是我在十幾年前從一本英文書中翻譯成中文的，今日一時興起，在GOOGLE搜尋了一下，沒想到可以得到24萬筆以上的結果；<br>還被遠流出版社出版過。有佛教、天主教、基督教的網站引用，甚至熱烈討論，當然也有些傳銷業者等等的使用。<br>但是他們可能都不知道，這是一個回教蘇菲教派的寓言故事，用來揭示一些修行的真理。<br>我相信有些宗教人士，一旦知道這是源自回教的故事，就會心生芥蒂，他們看這個故事的感覺就變了….<br>其實真理一直在那邊，但是我們凡夫的眼光有限，只能用自己的小我來認知，每個人、每個宗教都只能認知一部份，<br>如今一些極端宗教人士，為了強調自己所信仰宗教的崇高、唯一性，<br>卻要去貶抑、甚至仇視其他宗教，在我看來，這些都是因為人們沒將心眼打開、無法看到無所不在的愛，<br>所以被自己的我執所限制，才有這些分裂與誤解，甚至衍生成仇恨與殺戮。<br>可嘆..</p>]]></content>
      
      
      <categories>
          
          <category> 寓言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 寓言 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>armbian跑AI网络-Yolo做识别的尝试</title>
      <link href="/2020/08/19/yolo-test1/"/>
      <url>/2020/08/19/yolo-test1/</url>
      
        <content type="html"><![CDATA[<p>这个板子是8核A53的amlogic 的S912 . 不过我看过对比，比起A72的新的树莓4，还是差很多，平均1个A72=4个A53. 树莓4有4个A72.</p><p>树莓4才有0.1T的计算力。 这样算，这个才有0.05T个算力。</p><p>过程写一下。</p><p>准备<br>‘’’<br>sudo apt-get install python-opencv<br>sudo apt-get install python-pip<br>sudo pip install –upgrade git+<a href="https://github.com/Maratyszcza/PeachPy" target="_blank" rel="noopener">https://github.com/Maratyszcza/PeachPy</a><br>sudo pip install –upgrade git+<a href="https://github.com/Maratyszcza/confu" target="_blank" rel="noopener">https://github.com/Maratyszcza/confu</a><br>‘’’</p><p>这个过程会出错，说少这个少那个， 看见少的就安装，用apt install xxxx<br>比如<br>少 No module named ‘setuptools’<br>少wheel</p><p>必须安装下面这个,到底有什么用,不知道,会不会和下面这个重复,不清楚,反正我之前没下载, 后面这个反复编译都出错<br>‘’’<br>sudo apt-get install ninja-build<br>‘’’</p><p>安装编译器,这个过程会下载很多依赖库,可能会出错,出错重新来,<br>‘’’<br>git clone <a href="https://github.com/ninja-build/ninja.git" target="_blank" rel="noopener">https://github.com/ninja-build/ninja.git</a><br>cd ninja<br>git checkout release<br>./configure.py –bootstrap<br>export NINJA_PATH=$PWD<br>‘’’</p><p>下载编译nnpack<br>‘’’<br>git clone <a href="https://github.com/shizukachan/NNPACK" target="_blank" rel="noopener">https://github.com/shizukachan/NNPACK</a><br>cd NNPACK<br>confu setup<br>python ./configure.py –backend auto<br>$NINJA_PATH/ninja</p><p>sudo cp -a lib/* /usr/lib/<br>sudo cp include/nnpack.h /usr/include/<br>sudo cp deps/pthreadpool/include/pthreadpool.h /usr/include/</p><p>‘’’</p><p>下载编译darknet<br>‘’’<br>git clone -b yolov3 <a href="https://github.com/zxzhaixiang/darknet-nnpack" target="_blank" rel="noopener">https://github.com/zxzhaixiang/darknet-nnpack</a><br>cd darknet-nnpack<br>git checkout yolov3<br>make<br>‘’’</p><p>测试 ,运行<br>python rpi_video.py</p><p>不过我得是usb接口摄像头, 要修过,用图片测试是ok得.</p>]]></content>
      
      
      <categories>
          
          <category> AI </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AI armbian </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>armbian 阿里云源地址</title>
      <link href="/2020/08/17/aliyun-port-addr/"/>
      <url>/2020/08/17/aliyun-port-addr/</url>
      
        <content type="html"><![CDATA[<p>/etc/apt/source.list</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">deb http://mirrors.aliyun.com/ubuntu-ports/ bionic main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu-ports/ bionic-security main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu-ports/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu-ports/ bionic-proposed main restricted universe multiverse</span><br><span class="line">deb http://mirrors.aliyun.com/ubuntu-ports/ bionic-backports main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu-ports/ bionic main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu-ports/ bionic-security main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu-ports/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu-ports/ bionic-proposed main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.aliyun.com/ubuntu-ports/ bionic-backports main restricted universe multiverse</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>心悸-桂枝甘草汤体验</title>
      <link href="/2020/07/31/guizhi1/"/>
      <url>/2020/07/31/guizhi1/</url>
      
        <content type="html"><![CDATA[<p>最近不知道何故，可能是出大汗的原因，出汗时都感觉到心悸，心痛。然后，非常明显几天之内，出现经常心悸情况，就是心跳很快，很不正常，心很不舒服，下午3-5点先是脚趾感觉到冷，一天后同样时间段，感觉到连手指都冷。完蛋，心脏出大问题， 一睡觉心悸得根本睡不着，整个晚上失眠。睡着就是心悸醒，然后竟然左右手麻，开始是左手，一天后连右手也是，心想完蛋，是不是快死的节奏。</p><p>学中医功力还不够，不知道怎么处理，之前晚上有时候醒来也发现有心悸情况，本来以为是身体有痰有湿堵住，心跳加速来补偿身体需要。怎么发现几天之内情况急速恶化。吓死了，以为真的就这么大。</p><p>想到之听到的奔豚的现象的时候，有桂枝加桂汤，看了有类似的汤剂。发现桂枝甘草汤就是处理这个心阳虚，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">桂枝 甘草</span><br><span class="line"></span><br><span class="line">条辩：</span><br><span class="line">发汗过多，其人叉手自冒心，心下悸，欲得按者。</span><br></pre></td></tr></table></figure><p>欲按，虚证。</p><p>于是我买肉桂，应该是紫油桂，算比较好，真如老师（施合一）所说的，气没有食品那些肉桂那么香，但是反而更适合走里。</p><p>于是打粉。先煮了一些炙甘草，然后配合几克肉桂粉。</p><p>然后，晚上睡觉，很好，没有心悸，而且很久没有睡的那么深沉。神效。</p><p>能得这个病，肯定心脏也不怎么健康了。再观察吧。</p>]]></content>
      
      
      <categories>
          
          <category> 中医 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 中医 经方 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>armbian定时播放mp3</title>
      <link href="/2020/01/07/cron-play-mp3/"/>
      <url>/2020/01/07/cron-play-mp3/</url>
      
        <content type="html"><![CDATA[<p>为了小孩多听粤语,想播放以前收音机里面的小说节目,于是做了一个这样的东西, 每天定时大约吃饭时间播放一集节目, 第一季节目就播三国演义把.</p><p>垃圾电视盒刷armbian, 接usb 声卡, 一个功放模块,一个控制模块, 三个模块都是自己做了, 控制模块是usb转串口,接一个单片机,控制功放模块的电源, 因为24小时不停待机,因此不播放的时候要休眠状态.<br>垃圾电视盒是没有IO的,所以有这个东西.</p><p>安装所有必须的东西<br>samba, cifs-utils , 音频文件在nas上,所以要装samba 共享.<br>stty,控制串口波特率等<br>sox , 播放mp3的的东西<br>python, 控制脚本</p><p>python 脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line"></span><br><span class="line">import json</span><br><span class="line">import os</span><br><span class="line">import linecache</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">filename = &apos;cur_play_id.json&apos;</span><br><span class="line">list_name = &apos;play_list&apos;</span><br><span class="line">index=1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">os.system(&apos;stty -F /dev/ttyUSB0 115200&apos;)</span><br><span class="line">os.system (&apos;echo &quot;:9000020101aa\r\n&quot; &gt;&gt; /dev/ttyUSB0&apos;)</span><br><span class="line">os.system (&apos;play sanya.mp3&apos;)</span><br><span class="line"></span><br><span class="line">if len(sys.argv)  &gt; 1  :</span><br><span class="line">    list_name= sys.argv[1]</span><br><span class="line">  </span><br><span class="line">print(list_name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line"></span><br><span class="line">    with open (filename) as f_obj:</span><br><span class="line">        ja=json.load(f_obj)</span><br><span class="line">        index=ja[&apos;cur_index&apos;]</span><br><span class="line">        index = index +1</span><br><span class="line"></span><br><span class="line">except FileNotFoundError:</span><br><span class="line">    print(&quot;index file Not Found!@!!!&quot;)</span><br><span class="line">    index = 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line"></span><br><span class="line">    play_file = linecache.getline(list_name,index).strip()</span><br><span class="line">    if play_file ==&apos;&apos; :</span><br><span class="line">        print (&quot;end of play list file&quot;)</span><br><span class="line">    else :</span><br><span class="line">        a_cmd = &apos;play &apos; + play_file</span><br><span class="line">        print(a_cmd)</span><br><span class="line">        os.system(a_cmd)</span><br><span class="line">        os.system (&apos;echo &quot;:9000020100aa\r\n&quot; &gt;&gt; /dev/ttyUSB0&apos;)</span><br><span class="line"></span><br><span class="line">except FileNotFoundError:</span><br><span class="line">    print (&quot;Play List file not found!!&quot;)</span><br><span class="line">    os._exit(0)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data_dic = &#123;&apos;cur_index&apos;:index&#125;</span><br><span class="line"></span><br><span class="line">with open(filename,&apos;w&apos;) as f:</span><br><span class="line">    json.dump(data_dic,f)</span><br></pre></td></tr></table></figure><p>用法就是python play_mp3.py list.txt</p><p>生成播放列表文件的脚本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -1 |awk &apos;&#123;print i$0&#125;&apos; i=`pwd`&apos;/&apos; &gt; list.txt</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linux 默认声卡设置</title>
      <link href="/2019/12/06/armbian-default-sound-card/"/>
      <url>/2019/12/06/armbian-default-sound-card/</url>
      
        <content type="html"><![CDATA[<p>下面是修改第二个声卡为缺省声卡</p><p>/etc/asound.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">defaults.pcm.card 1</span><br><span class="line">defaults.pcm.device 0</span><br><span class="line">defaults.ctl.card 1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>随笔</title>
      <link href="/2019/11/21/sui1/"/>
      <url>/2019/11/21/sui1/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> live </category>
          
      </categories>
      
      
        <tags>
            
            <tag> live </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>905盒子装armbian后基本设置</title>
      <link href="/2019/10/31/armbian-mac/"/>
      <url>/2019/10/31/armbian-mac/</url>
      
        <content type="html"><![CDATA[<p>#设置mac</p><p>盒子mac 没有,<br>直接编辑 /etc/network/interfaces 文件，在 iface eth0 inet static 后面添加一行：<br>pre-up ifconfig eth0 hw ether xx:xx:xx:xx:xx:xx（要改成的MAC）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">iface eth0 inet static</span><br><span class="line">pre-up ifconfig eth0 hw ether xx:xx:xx:xx:xx:xx（要改成的MAC）</span><br><span class="line">address 192.168.1.10</span><br><span class="line">netmask 255.255.255.0</span><br><span class="line">gateway 192.168.1.1</span><br></pre></td></tr></table></figure><p>对于wifi 也是一样</p><p>另外一种说法 uboot 中设置,不过我试过不行</p><p>/boot/uEnv.ini  </p><p>dtb_name=/dtb/meson-gxl-s905d-phicomm-n1.dtb<br>bootargs=root=LABEL=ROOT_EMMC rootflags=data=writeback rw console=ttyAML0,115200n8 console=tty0 no_cons…………………..<br>ethaddr=42:b8:79:09:d8:ed</p><p>#设置时区</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;Asia/Shanghai&quot; &gt; /etc/timezone &amp;&amp; ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span><br></pre></td></tr></table></figure><p>#设置语言环境<br>/etc/environment</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ARCH=arm64</span><br><span class="line">LC_ALL=&quot;en_US.UTF-8&quot;</span><br><span class="line">LANG=&quot;en_US.UTF-8&quot;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>add rtl8189fs driver for armbian</title>
      <link href="/2019/10/22/add-rtl8189fs-driver-armbian/"/>
      <url>/2019/10/22/add-rtl8189fs-driver-armbian/</url>
      
        <content type="html"><![CDATA[<p>数码视讯Q7 的垃圾电视盒30元一个,S905L芯片, A53 x 4 ,1G RAM , 可以跑很多东西,本来想跑一些nas应用,后来猫盘,什么我家云等矿渣也不断出来,就放弃, 现在计划拿来跑AI的一些视频识别应用.</p><p>armbian 上面针对S905的都没有rtl8189的驱动,那就自己加</p><p>下载virtul box, 在上面跑一个unbutu的虚拟机,这里必须用官方mini.iso来安装.不能用18.4.3 这个官方推荐版本,说来都是泪,说白了就是版本依赖的问题.</p><p>下载armbian build脚本,我们用150balbes 针对s905的版本</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/150balbes/Build-Armbian</span><br><span class="line">cd Build-Armbian</span><br><span class="line">./compile.sh BOARD=aml-g12 BRANCH=default RELEASE=bionic BUILD_MINIMAL=no BUILD_DESKTOP=no KERNEL_ONLY=no KERNEL_CONFIGURE=yes</span><br></pre></td></tr></table></figure><p> 下面这段话是别人的</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">BOARD 设置为 aml-g12，可以选 aml-s905，但是只有 aml-g12 编译时用的源码是最新的</span><br><span class="line">BRANCH 编译使用的源码分支 在 105 的 build 中，default 使用的是他自己 fork 的 S905 kernel 源码</span><br><span class="line">RELEASE 为需要编译的版本，我这里设置为 Ubuntu 19.04 disco，可以选择 buster bionic stretch xenial 等</span><br><span class="line">BUILD_MINIMAL 是否为最小版本，这个选项改为 yes 之后，没有 armbian-config 了，所以还是把它改为了 no</span><br><span class="line">BUILD_DESKTOP 是否编译桌面版本</span><br><span class="line">KERNEL_ONLY 是否只编译内核</span><br><span class="line">KERNEL_CONFIGURE 是否在开始编译是打开内核配置，这个选项需要设置为 yes，来添加我们需要的 WIFI 驱动</span><br></pre></td></tr></table></figure><p>修改 /Build-Armbian/lib/compilation-prepare.sh 脚本</p><p>增加下载编译rtl8189的代码<br>代码在这里 <a href="https://github.com/jwrdegoede/rtl8189ES_linux" target="_blank" rel="noopener">https://github.com/jwrdegoede/rtl8189ES_linux</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># Wireless drivers for Realtek 8189ES  chipsets</span><br><span class="line"></span><br><span class="line">if linux-version compare $version ge 3.14 &amp;&amp; [ &quot;$EXTRAWIFI&quot; == yes ]; then</span><br><span class="line"></span><br><span class="line">        # attach to specifics tag or branch</span><br><span class="line">        local rtl8189es=&quot;branch:rtl8189fs&quot; #必须用这个分支</span><br><span class="line"></span><br><span class="line">        display_alert &quot;Adding&quot; &quot;Wireless drivers for Realtek 8189fs chipsets $&#123;rtl8189es&#125;&quot; &quot;info&quot;</span><br><span class="line"></span><br><span class="line">        fetch_from_repo &quot;https://github.com/jwrdegoede/rtl8189ES_linux&quot; &quot;rtl8189fs&quot; &quot;$&#123;rtl8189es&#125;&quot; &quot;yes&quot;</span><br><span class="line">        cd $&#123;SRC&#125;/cache/sources/$&#123;LINUXSOURCEDIR&#125;</span><br><span class="line">        rm -rf $&#123;SRC&#125;/cache/sources/$&#123;LINUXSOURCEDIR&#125;/drivers/net/wireless/rtl8189fs</span><br><span class="line">        mkdir -p $&#123;SRC&#125;/cache/sources/$&#123;LINUXSOURCEDIR&#125;/drivers/net/wireless/rtl8189fs/</span><br><span class="line">        cp -R $&#123;SRC&#125;/cache/sources/rtl8189fs/$&#123;rtl8189es#*:&#125;/&#123;core,hal,include,os_dep,platform&#125; \</span><br><span class="line">        $&#123;SRC&#125;/cache/sources/$&#123;LINUXSOURCEDIR&#125;/drivers/net/wireless/rtl8189fs</span><br><span class="line"></span><br><span class="line">        # Makefile</span><br><span class="line">        cp $&#123;SRC&#125;/cache/sources/rtl8189fs/$&#123;rtl8189es#*:&#125;/Makefile \</span><br><span class="line">        $&#123;SRC&#125;/cache/sources/$&#123;LINUXSOURCEDIR&#125;/drivers/net/wireless/rtl8189fs/Makefile</span><br><span class="line">        cp $&#123;SRC&#125;/cache/sources/rtl8189fs/$&#123;rtl8189es#*:&#125;/Kconfig \</span><br><span class="line">        $&#123;SRC&#125;/cache/sources/$&#123;LINUXSOURCEDIR&#125;/drivers/net/wireless/rtl8189fs/Kconfig</span><br><span class="line"></span><br><span class="line">        # Add to section Makefile</span><br><span class="line">        echo &quot;obj-\$(CONFIG_RTL8189FS) += rtl8189fs/&quot; &gt;&gt; $SRC/cache/sources/$&#123;LINUXSOURCEDIR&#125;/drivers/net/wireless/Makefile</span><br><span class="line">        sed -i &apos;/source &quot;drivers\/net\/wireless\/ti\/Kconfig&quot;/a source &quot;drivers\/net\/wireless\/rtl8189fs\/Kconfig&quot;&apos; \</span><br><span class="line">        $SRC/cache/sources/$&#123;LINUXSOURCEDIR&#125;/drivers/net/wireless/Kconfig</span><br><span class="line"></span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>然后就重新编译就可以, 上面看上去好像很简单,我也搞了几天.</p><p>下面这段事别人的, <a href="https://blog.csdn.net/jklinux/article/details/78737691" target="_blank" rel="noopener">https://blog.csdn.net/jklinux/article/details/78737691</a></p><p>我复制过来, 有时候有用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line">通过检查电路原理图，可以发现此wifi芯片是连接到板上mmc1控制器上的。H5共有三个sd/mmc控制器, 而控制器驱动是platform_driver, 需要用platform_device或在设备树里提供硬件控制器的硬件资源.</span><br><span class="line"></span><br><span class="line">在H5的设备树sunxi-h3-h5.dtsi文件里,而描述好三个sd/mmc控制器的设备节点:</span><br><span class="line"></span><br><span class="line">        mmc0: mmc@01c0f000 &#123;</span><br><span class="line">            /* compatible and clocks are in per SoC .dtsi file */</span><br><span class="line">            reg = &lt;0x01c0f000 0x1000&gt;;</span><br><span class="line">            resets = &lt;&amp;ccu RST_BUS_MMC0&gt;;</span><br><span class="line">            reset-names = &quot;ahb&quot;;</span><br><span class="line">            interrupts = &lt;GIC_SPI 60 IRQ_TYPE_LEVEL_HIGH&gt;;</span><br><span class="line">            status = &quot;enabled&quot;;</span><br><span class="line">            #address-cells = &lt;1&gt;;</span><br><span class="line">            #size-cells = &lt;0&gt;;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        mmc1: mmc@01c10000 &#123;</span><br><span class="line">            /* compatible and clocks are in per SoC .dtsi file */</span><br><span class="line">            reg = &lt;0x01c10000 0x1000&gt;;</span><br><span class="line">            resets = &lt;&amp;ccu RST_BUS_MMC1&gt;;</span><br><span class="line">            reset-names = &quot;ahb&quot;;</span><br><span class="line">            interrupts = &lt;GIC_SPI 61 IRQ_TYPE_LEVEL_HIGH&gt;;</span><br><span class="line">            status = &quot;enabled&quot;;</span><br><span class="line">            #address-cells = &lt;1&gt;;</span><br><span class="line">            #size-cells = &lt;0&gt;;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        mmc2: mmc@01c11000 &#123;</span><br><span class="line">            /* compatible and clocks are in per SoC .dtsi file */</span><br><span class="line">            reg = &lt;0x01c11000 0x1000&gt;;</span><br><span class="line">            resets = &lt;&amp;ccu RST_BUS_MMC2&gt;;</span><br><span class="line">            reset-names = &quot;ahb&quot;;</span><br><span class="line">            interrupts = &lt;GIC_SPI 62 IRQ_TYPE_LEVEL_HIGH&gt;;</span><br><span class="line">            status = &quot;enabled&quot;;</span><br><span class="line">            #address-cells = &lt;1&gt;;</span><br><span class="line">            #size-cells = &lt;0&gt;;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">但三个设备节点的status属性值不是”okay”的话，是不会生效的. 而且还需要提供sd/mmc控制器使用的gpio口配置信息.</span><br><span class="line"></span><br><span class="line">在设备树文件sun50i-h5-nanopi-neo2.dts里，已提供让mmc0控制器生效的设备节点:</span><br><span class="line"></span><br><span class="line">&amp;mmc0 &#123;</span><br><span class="line">    pinctrl-names = &quot;default&quot;;</span><br><span class="line">    pinctrl-0 = &lt;&amp;mmc0_pins_a&gt;, &lt;&amp;mmc0_cd_pin&gt;;</span><br><span class="line">    vmmc-supply = &lt;&amp;reg_vcc3v3&gt;;</span><br><span class="line">    bus-width = &lt;4&gt;;</span><br><span class="line">    cd-gpios = &lt;&amp;pio 5 6 GPIO_ACTIVE_LOW&gt;; /* PF6 */</span><br><span class="line">    boot_device = &lt;1&gt;;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">所以要想使用mmc1控制器，再增加一个mmc的设备节点即可:</span><br><span class="line"></span><br><span class="line">&amp;mmc1 &#123;</span><br><span class="line">    pinctrl-names = &quot;default&quot;;</span><br><span class="line">    pinctrl-0 = &lt;&amp;mmc1_pins_a&gt;;</span><br><span class="line">    vmmc-supply = &lt;&amp;reg_vcc3v3&gt;;</span><br><span class="line">    bus-width = &lt;4&gt;;</span><br><span class="line">    status = &quot;okay&quot;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">修改完成后更新使用设备树，进入系统后:</span><br><span class="line"></span><br><span class="line">//查看到已有两个设备与sd/mmc控制器的驱动匹配上了:</span><br><span class="line">^_^ / # ls /sys/bus/platform/drivers/sunxi-mmc/</span><br><span class="line">1c0f000.mmc/  1c10000.mmc/  bind          uevent        unbind</span><br><span class="line"></span><br><span class="line">sd/mmc控制器驱动好后，它会自动读取sdio设备的信息，并在系统里创建出相应的sdio设备信息:</span><br><span class="line"></span><br><span class="line">这里可以获取到wifi芯片的厂家和设备id, wifi设备驱动里是根据这些id来作匹配的.</span><br><span class="line"></span><br><span class="line">^_^ / # cat /sys/bus/sdio/devices/mmc2\:0001\:1/device </span><br><span class="line">0xf179</span><br><span class="line">^_^ / # cat /sys/bus/sdio/devices/mmc2\:0001\:1/vendor </span><br><span class="line">0x024c</span><br><span class="line"></span><br><span class="line">通过官网的说明: http://linux-sunxi.org/Wifi#RTL8189FTV</span><br><span class="line">rtl8189ftv型号的wifi用的就是rtl8189ES驱动. 与型号8189fs一致.</span><br><span class="line"></span><br><span class="line">下载驱动源码: git clone https://github.com/jwrdegoede/rtl8189ES_linux.git</span><br><span class="line">        git checkout -b rtl8189fs origin/rtl8189fs  //下载8189fs的分支</span><br><span class="line">        git pull    //检查更新</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">驱动源码下载后， 可以发现此驱动源码是可以支持很多个型号的wifi芯片.</span><br><span class="line"></span><br><span class="line">在驱动源码os_dep/linux/sdio_intf.c文件里, 可以看到匹配用的设备id表:</span><br><span class="line"></span><br><span class="line">  47 static const struct sdio_device_id sdio_ids[] =</span><br><span class="line">  48 &#123;</span><br><span class="line">  49 #ifdef CONFIG_RTL8723B</span><br><span class="line">  50     &#123; SDIO_DEVICE(0x024c, 0xB723),.driver_data = RTL8723B&#125;,</span><br><span class="line">  51 #endif</span><br><span class="line">  52 #ifdef CONFIG_RTL8188E</span><br><span class="line">  53     &#123; SDIO_DEVICE(0x024c, 0x8179),.driver_data = RTL8188E&#125;,</span><br><span class="line">  54 #endif //CONFIG_RTL8188E</span><br><span class="line">  55 </span><br><span class="line">  56 #ifdef CONFIG_RTL8821A</span><br><span class="line">  57     &#123; SDIO_DEVICE(0x024c, 0x8821),.driver_data = RTL8821&#125;,</span><br><span class="line">  58 #endif //CONFIG_RTL8821A</span><br><span class="line">  59 </span><br><span class="line">  60 #ifdef CONFIG_RTL8192E</span><br><span class="line">  61     &#123; SDIO_DEVICE(0x024c, 0x818B),.driver_data = RTL8192E&#125;,</span><br><span class="line">  62 #endif //CONFIG_RTL8192E</span><br><span class="line">  63 </span><br><span class="line">  64 #ifdef CONFIG_RTL8703B</span><br><span class="line">  65     &#123; SDIO_DEVICE(0x024c, 0xB703), .driver_data = RTL8703B&#125;,</span><br><span class="line">  66 #endif</span><br><span class="line">  67 </span><br><span class="line">  68 #ifdef CONFIG_RTL8188F    //rtl8189ftv的厂家和设备id</span><br><span class="line">  69     &#123;SDIO_DEVICE(0x024c, 0xF179), .driver_data = RTL8188F&#125;,</span><br><span class="line">  70 #endif</span><br><span class="line">      ....</span><br><span class="line"></span><br><span class="line">  98 static struct sdio_drv_priv sdio_drvpriv = &#123;</span><br><span class="line">  99     .r871xs_drv.probe = rtw_drv_init,</span><br><span class="line"> 100     .r871xs_drv.remove = rtw_dev_remove,</span><br><span class="line"> 101     .r871xs_drv.name = (char*)DRV_NAME,</span><br><span class="line"> 102     .r871xs_drv.id_table = sdio_ids,</span><br><span class="line"> 103     #if (LINUX_VERSION_CODE &gt;= KERNEL_VERSION(2,6,29)) </span><br><span class="line"> 104     .r871xs_drv.drv = &#123;</span><br><span class="line"> 105         .pm = &amp;rtw_sdio_pm_ops,</span><br><span class="line"> 106     &#125;</span><br><span class="line"> 107     #endif</span><br><span class="line"> 108 &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">具体要编译支持哪个芯片，需要修改里面的Makefile.</span><br><span class="line">//只要作了git checkout … 里面会自动修改支持8189ftv/818fs的.</span><br><span class="line">Makefile里的内容:</span><br><span class="line"></span><br><span class="line">  38 CONFIG_RTL8188F = y   </span><br><span class="line">  39 ######################### Interface ###########################</span><br><span class="line">  40 CONFIG_USB_HCI = n</span><br><span class="line">  41 CONFIG_PCI_HCI = n</span><br><span class="line">  42 CONFIG_SDIO_HCI = y</span><br><span class="line"></span><br><span class="line">//需要修改的内容: </span><br><span class="line"> 114 CONFIG_PLATFORM_ARM_SUNxI = y</span><br><span class="line">    ...</span><br><span class="line">1373 ARCH := arm64</span><br><span class="line"></span><br><span class="line">1375 CROSS_COMPILE=aarch64-linux-gnu-</span><br><span class="line">    ...</span><br><span class="line">1378 KSRC=~/fH5/NanoPi-NEO2/sources/linux/</span><br><span class="line"></span><br><span class="line">修改完成后，执行Makefile, 最终会生成8189fs.ko。在板上系统加载此驱动模块后，会有”wlan0”网络设备.</span><br><span class="line">————————————————</span><br><span class="line">版权声明：本文为CSDN博主「jklinux」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。</span><br><span class="line">原文链接：https://blog.csdn.net/jklinux/article/details/78737691</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>自动更新aria2的tracker list</title>
      <link href="/2019/10/08/auto-update-trackerlist/"/>
      <url>/2019/10/08/auto-update-trackerlist/</url>
      
        <content type="html"><![CDATA[<p>(原文在这里)[<a href="https://stray.love/itshou-zha/wei-aria2-tian-jia-tracker-fu-wu-qi]" target="_blank" rel="noopener">https://stray.love/itshou-zha/wei-aria2-tian-jia-tracker-fu-wu-qi]</a></p><p>把下面脚本放入定时任务,然后通过rpc更新 ,简单方便快捷</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line">#more trackers list, see https://github.com/ngosang/trackerslist</span><br><span class="line"></span><br><span class="line">tracker_url=&apos;https://raw.githubusercontent.com/ngosang/trackerslist/master/trackers_all.txt&apos;</span><br><span class="line">path=&apos;http://10.10.10.5:6800/jsonrpc&apos;</span><br><span class="line">passwd=&apos;xxxxxx&apos;</span><br><span class="line"></span><br><span class="line">tracker=$(echo -n  $(curl -s -L $tracker_url | sed &apos;N;s/\n//g&apos;) | tr &apos; &apos; &apos;,&apos;)</span><br><span class="line">[ -n &quot;$tracker&quot; ] &amp;&amp; curl $path -d &apos;&#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;aria2.changeGlobalOption&quot;,&quot;id&quot;:&quot;cron&quot;,&quot;params&quot;:[&quot;token:&apos;$passwd&apos;&quot;,&#123;&quot;bt-tracker&quot;:&quot;&apos;$tracker&apos;&quot;&#125;]&#125;&apos;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>矿渣猫盘安装aria2 + ariaNg + nginx</title>
      <link href="/2019/09/29/aria2-ariaNg/"/>
      <url>/2019/09/29/aria2-ariaNg/</url>
      
        <content type="html"><![CDATA[<p>利用猫盘做一个下载机,其实也没什么东西要下载,迅雷都可以,干嘛还要做这样一台机呢? 折腾罢了. aria2下载速度远远不如迅雷的,但是还要折腾这个,还是有一点比迅雷好的地方的,就是可以利用晚上时间下载.</p><p>猫盘刷debin系统, 不表.</p><p><a href="https://github.com/hanwckf/build-catdrive/" target="_blank" rel="noopener">fireware在这里</a></p><p>然后apt instll aria2 nginx等组件.</p><p>airaNg 的要手动下载,apt 安装不了.</p><p>重点说配置把,aria2 最重要就是配置文件,这个网上有, 主要事要做一个service加入系统服务中<br>在/etc/systemd/system 下面做一个aira2.service文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Aria2 Service</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">ExecStart=aria2c --enable-rpc=true --input-file=/root/aria2/aria2.session --conf-path=/root/aria2/aria2.conf</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure><p>必须放入/etc/systemd/system中,不要放入user文件夹中 ,会导致退出登录后无法连接到airaNg的问题.</p><p>ariaNg 下载后/var/www/html/下面 ,不要放到其他地方,如果放到其他地方,nginx 要配置,当然如果你会配nginx,当我没说. 我比较懒,就不配了,自己放入,然后就可以访问.</p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>用curl透过ftps 协议上传文件(vsftpd,ssh)</title>
      <link href="/2019/09/06/curl-ftps/"/>
      <url>/2019/09/06/curl-ftps/</url>
      
        <content type="html"><![CDATA[<p>curl 不单单是下载工具,还可以上传,支持众多协议.<br>我有一个摄像头接在ar9331 上面,跑mjpeg-stream,主要是拍照,监控淋花的情况,每天拍一张都两张照片,为什么不用现成的摄像头呢? 其实也可以,不过了,一来做来玩玩,另外一个可以把多年照片存起来,这个还是有点意思.</p><p>不说废话</p><p>在公司内网开内一个ftp服务器, 要端口映射到外网,这里面有点技巧,<br>ftp现在都是加密的,要不然就太不安全. 必须ssh.</p><p>内网ftp服务器vsftpd的设置</p><p>/etc/vsftpd.conf 关键地方我用中文标记</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"># Example config file /etc/vsftpd.conf</span><br><span class="line">#</span><br><span class="line"># The default compiled in settings are fairly paranoid. This sample file</span><br><span class="line"># loosens things up a bit, to make the ftp daemon more usable.</span><br><span class="line"># Please see vsftpd.conf.5 for all compiled in defaults.</span><br><span class="line">#</span><br><span class="line"># READ THIS: This example file is NOT an exhaustive list of vsftpd options.</span><br><span class="line"># Please read the vsftpd.conf.5 manual page to get a full idea of vsftpd&apos;s</span><br><span class="line"># capabilities.</span><br><span class="line">#</span><br><span class="line">#</span><br><span class="line"># Run standalone?  vsftpd can run either from an inetd or as a standalone</span><br><span class="line"># daemon started from an initscript.</span><br><span class="line">listen=Yes  关闭ipv6 后必须打开这个</span><br><span class="line">#</span><br><span class="line"># This directive enables listening on IPv6 sockets. By default, listening</span><br><span class="line"># on the IPv6 &quot;any&quot; address (::) will accept connections from both IPv6</span><br><span class="line"># and IPv4 clients. It is not necessary to listen on *both* IPv4 and IPv6</span><br><span class="line"># sockets. If you want that (perhaps because you want to listen on specific</span><br><span class="line"># addresses) then you must run two copies of vsftpd with two configuration</span><br><span class="line"># files.</span><br><span class="line">listen_ipv6=No 必须关闭ipv6 ,否则最后传不到实际外网的ip地址</span><br><span class="line">#</span><br><span class="line"># Allow anonymous FTP? (Disabled by default).</span><br><span class="line">anonymous_enable=NO</span><br><span class="line">#</span><br><span class="line"># Uncomment this to allow local users to log in.</span><br><span class="line">local_enable=YES</span><br><span class="line">#</span><br><span class="line"># Uncomment this to enable any form of FTP write command.</span><br><span class="line">write_enable=YES</span><br><span class="line">#</span><br><span class="line"># Default umask for local users is 077. You may wish to change this to 022,</span><br><span class="line"># if your users expect that (022 is used by most other ftpd&apos;s)</span><br><span class="line">local_umask=022</span><br><span class="line">#</span><br><span class="line"># Uncomment this to allow the anonymous FTP user to upload files. This only</span><br><span class="line"># has an effect if the above global write enable is activated. Also, you will</span><br><span class="line"># obviously need to create a directory writable by the FTP user.</span><br><span class="line">#anon_upload_enable=YES</span><br><span class="line">#</span><br><span class="line"># Uncomment this if you want the anonymous FTP user to be able to create</span><br><span class="line"># new directories.</span><br><span class="line">#anon_mkdir_write_enable=YES</span><br><span class="line">#</span><br><span class="line"># Activate directory messages - messages given to remote users when they</span><br><span class="line"># go into a certain directory.</span><br><span class="line">dirmessage_enable=YES</span><br><span class="line">#</span><br><span class="line"># If enabled, vsftpd will display directory listings with the time</span><br><span class="line"># in  your  local  time  zone.  The default is to display GMT. The</span><br><span class="line"># times returned by the MDTM FTP command are also affected by this</span><br><span class="line"># option.</span><br><span class="line">use_localtime=YES</span><br><span class="line">#</span><br><span class="line"># Activate logging of uploads/downloads.</span><br><span class="line">xferlog_enable=YES</span><br><span class="line">#</span><br><span class="line"># Make sure PORT transfer connections originate from port 20 (ftp-data).</span><br><span class="line">connect_from_port_20=YES</span><br><span class="line">#</span><br><span class="line"># If you want, you can arrange for uploaded anonymous files to be owned by</span><br><span class="line"># a different user. Note! Using &quot;root&quot; for uploaded files is not</span><br><span class="line"># recommended!</span><br><span class="line">#chown_uploads=YES</span><br><span class="line">#chown_username=whoever</span><br><span class="line">#</span><br><span class="line"># You may override where the log file goes if you like. The default is shown</span><br><span class="line"># below.</span><br><span class="line">#xferlog_file=/var/log/vsftpd.log</span><br><span class="line">#</span><br><span class="line"># If you want, you can have your log file in standard ftpd xferlog format.</span><br><span class="line"># Note that the default log file location is /var/log/xferlog in this case.</span><br><span class="line">#xferlog_std_format=YES</span><br><span class="line">#</span><br><span class="line"># You may change the default value for timing out an idle session.</span><br><span class="line">#idle_session_timeout=600</span><br><span class="line">#</span><br><span class="line"># You may change the default value for timing out a data connection.</span><br><span class="line">#data_connection_timeout=120</span><br><span class="line">#</span><br><span class="line"># It is recommended that you define on your system a unique user which the</span><br><span class="line"># ftp server can use as a totally isolated and unprivileged user.</span><br><span class="line">#nopriv_user=ftpsecure</span><br><span class="line">#</span><br><span class="line"># Enable this and the server will recognise asynchronous ABOR requests. Not</span><br><span class="line"># recommended for security (the code is non-trivial). Not enabling it,</span><br><span class="line"># however, may confuse older FTP clients.</span><br><span class="line">#async_abor_enable=YES</span><br><span class="line">#</span><br><span class="line"># By default the server will pretend to allow ASCII mode but in fact ignore</span><br><span class="line"># the request. Turn on the below options to have the server actually do ASCII</span><br><span class="line"># mangling on files when in ASCII mode.</span><br><span class="line"># Beware that on some FTP servers, ASCII support allows a denial of service</span><br><span class="line"># attack (DoS) via the command &quot;SIZE /big/file&quot; in ASCII mode. vsftpd</span><br><span class="line"># predicted this attack and has always been safe, reporting the size of the</span><br><span class="line"># raw file.</span><br><span class="line"># ASCII mangling is a horrible feature of the protocol.</span><br><span class="line">#ascii_upload_enable=YES</span><br><span class="line">#ascii_download_enable=YES</span><br><span class="line">#</span><br><span class="line"># You may fully customise the login banner string:</span><br><span class="line">#ftpd_banner=Welcome to blah FTP service.</span><br><span class="line">#</span><br><span class="line"># You may specify a file of disallowed anonymous e-mail addresses. Apparently</span><br><span class="line"># useful for combatting certain DoS attacks.</span><br><span class="line">#deny_email_enable=YES</span><br><span class="line"># (default follows)</span><br><span class="line">#banned_email_file=/etc/vsftpd.banned_emails</span><br><span class="line">#</span><br><span class="line"># You may restrict local users to their home directories.  See the FAQ for</span><br><span class="line"># the possible risks in this before using chroot_local_user or</span><br><span class="line"># chroot_list_enable below.</span><br><span class="line">#chroot_local_user=YES</span><br><span class="line">#</span><br><span class="line"># You may specify an explicit list of local users to chroot() to their home</span><br><span class="line"># directory. If chroot_local_user is YES, then this list becomes a list of</span><br><span class="line"># users to NOT chroot().</span><br><span class="line"># (Warning! chroot&apos;ing can be very dangerous. If using chroot, make sure that</span><br><span class="line"># the user does not have write access to the top level directory within the</span><br><span class="line"># chroot)</span><br><span class="line">chroot_local_user=YES</span><br><span class="line">#chroot_list_enable=YES</span><br><span class="line"># (default follows)</span><br><span class="line">chroot_list_file=/etc/vsftpd.chroot_list</span><br><span class="line">#</span><br><span class="line"># You may activate the &quot;-R&quot; option to the builtin ls. This is disabled by</span><br><span class="line"># default to avoid remote users being able to cause excessive I/O on large</span><br><span class="line"># sites. However, some broken FTP clients such as &quot;ncftp&quot; and &quot;mirror&quot; assume</span><br><span class="line"># the presence of the &quot;-R&quot; option, so there is a strong case for enabling it.</span><br><span class="line">#ls_recurse_enable=YES</span><br><span class="line">#</span><br><span class="line"># Customization</span><br><span class="line">#</span><br><span class="line"># Some of vsftpd&apos;s settings don&apos;t fit the filesystem layout by</span><br><span class="line"># default.</span><br><span class="line">#</span><br><span class="line"># This option should be the name of a directory which is empty.  Also, the</span><br><span class="line"># directory should not be writable by the ftp user. This directory is used</span><br><span class="line"># as a secure chroot() jail at times vsftpd does not require filesystem</span><br><span class="line"># access.</span><br><span class="line">secure_chroot_dir=/var/run/vsftpd/empty</span><br><span class="line">#</span><br><span class="line"># This string is the name of the PAM service vsftpd will use.</span><br><span class="line">pam_service_name=vsftpd</span><br><span class="line">#</span><br><span class="line"># This option specifies the location of the RSA certificate to use for SSL</span><br><span class="line"># encrypted connections.</span><br><span class="line">rsa_cert_file=/etc/ssl/certs/xxxxx.pem</span><br><span class="line">rsa_private_key_file=/etc/ssl/private/xxxx.key</span><br><span class="line">ssl_enable=Yes</span><br><span class="line">force_local_data_ssl=Yes</span><br><span class="line">force_local_logins_ssl=Yes</span><br><span class="line">ssl_tlsv1=Yes</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Uncomment this to indicate that vsftpd use a utf8 filesystem.</span><br><span class="line">utf8_filesystem=YES</span><br><span class="line"></span><br><span class="line">userlist_enable=Yes</span><br><span class="line">userlist_deny=No</span><br><span class="line">userlist_file=/etc/vsftpd.user_list</span><br><span class="line">allow_writeable_chroot=Yes</span><br><span class="line"></span><br><span class="line">pasv_enable=Yes</span><br><span class="line">listen_port=??? //看需要</span><br><span class="line">pasv_max_port=???? //看需要</span><br><span class="line">pasv_min_port=????  //看需要</span><br><span class="line">pasv_addr_resolve=Yes // 必须用这个 , 否则下面要填实际ip,但是动态ip怎么可能有ip , 这是pasv 模式下,回传给客户段的ip地址,</span><br><span class="line">pasv_address=abc.com // 可以填域名,必须有上面那个yes</span><br></pre></td></tr></table></figure><p>然后把端口映射一下.</p><p>然后利用curl 上传,curl 是支持加密ftp的.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -k --ftp-ssl --ftp-ssl-reqd --ftp-create-dirs -T xxx.jpg -u user:password ftp://abcd.com:1000/</span><br></pre></td></tr></table></figure><p>-k 是忽略证书检查, 是ftp:// 不是ftps.</p>]]></content>
      
      
      <categories>
          
          <category> openwrt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> openwrt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hex Editor 的几个事项</title>
      <link href="/2019/09/06/hex-edit/"/>
      <url>/2019/09/06/hex-edit/</url>
      
        <content type="html"><![CDATA[<p>要提取702N 后64K的art部分 ,需要用hex editor, vscode 有一个hexdump的插件,不过不能复制截取, notepad++ 也有hexeditor的插件,不过搞来搞去都安装不成功,算了,那些事情就不说了,安装成功后,也没什么用,也非常不稳定,一下崩了. </p><p>最后还是用 <a href="https://mh-nexus.de/en/hxd/" target="_blank" rel="noopener">HxD</a> 这个免费的hex editor.</p><p>当然ultraEdit 也可以, 不过不免费,我也懒得用了.</p>]]></content>
      
      
      <categories>
          
          <category> PC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>获取mjpeg 照片脚本</title>
      <link href="/2019/09/04/cat-image/"/>
      <url>/2019/09/04/cat-image/</url>
      
        <content type="html"><![CDATA[<p>用时间作为文件夹和文件名</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line">folder=$(date &quot;+%Y%m%d&quot;)</span><br><span class="line">filename=$(date &quot;+%Y%m%d%H%M%S.jpg&quot;)</span><br><span class="line">#echo $filename $folder</span><br><span class="line"></span><br><span class="line">if test  -e /mnt/sda1/$folder </span><br><span class="line">then</span><br><span class="line">   echo &quot;folder exits&quot;</span><br><span class="line">else</span><br><span class="line">   mkdir /mnt/sda1/$folder</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">wget --o /mnt/sda1/$folder/$filename  http://localhost:8080/?action=snapshot</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> openwrt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> openwrt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nodemcu 运行 mqtt 做控制</title>
      <link href="/2019/08/29/nodemcu-mqtt/"/>
      <url>/2019/08/29/nodemcu-mqtt/</url>
      
        <content type="html"><![CDATA[<p>之前淋花, 控制灯的开关 都是nodemcu 做的,但是都是基于cron服务. 也就是定时服务. 定时服务简单,就是一个缺点,有时候这些东西要修改的时候比较麻烦,  要接上串口修改, 不接上串口 ,用telnet 去改也就可以但是总没那么直观,很容易出错而不知.</p><p>上去家中花严重缺水, 原来上次淋花器的一个程序有问题, 自己修改的时候不够细心,出错,倒是一个多月缺水, 于是下定决心修改一下.</p><p>现在把所有控制器都改到用mqtt协议连接到mqtt server上面, mqtt server 是自己搭建的. 运行在一个openwrt路由器上, 域名是阿里云域名,然后自己动态更新. 电信网络有公网IP ,于是就有了一些列的服务.</p><p>nodemcu 连接到mqtt server 上面,然后所有动作,都由服务器的cron 服务统一操作. 这样随时可以修改动作的时间,内容. 方便多了. 具体来说, 而且还可以根据当天天气清空改变淋花次数, 改变喂鱼机投喂次数, 比如天气寒冷,停止投喂.</p><p>代码<br>init.lua</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">--init for water </span><br><span class="line"></span><br><span class="line">gpio.mode(5, gpio.OUTPUT);</span><br><span class="line">--gpio.mode(4, gpio.OUTPUT);</span><br><span class="line">gpio.write(5, gpio.LOW);</span><br><span class="line"></span><br><span class="line">station_cfg=&#123;&#125;</span><br><span class="line">station_cfg.ssid=&quot;sdfasd&quot;;</span><br><span class="line">station_cfg.pwd=&quot;fasdfa&quot;</span><br><span class="line"></span><br><span class="line">-- 标识mqtt是否已经初始化</span><br><span class="line">mqtt_inited = 0</span><br><span class="line"></span><br><span class="line">-- 标识mqtt 是否已经连接</span><br><span class="line">mqtt_connecting = 0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function startup()</span><br><span class="line">   -- if file.open(&quot;init.lua&quot;) == nil then</span><br><span class="line">        --print(&quot;init.lua deleted or renamed&quot;)</span><br><span class="line">    --else</span><br><span class="line">        --print(&quot;Running&quot;)</span><br><span class="line">        --file.close(&quot;init.lua&quot;)</span><br><span class="line">        -- the actual application is stored in &apos;application.lua&apos;</span><br><span class="line">        -- dofile(&quot;application.lua&quot;)</span><br><span class="line">    --end</span><br><span class="line">    dofile(&quot;synctime.lua&quot;);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    mdns.register(&quot;water&quot;, &#123;hardware=&apos;NodeMCU&apos;&#125;);</span><br><span class="line">    print(&quot;mdns:water.local/&quot;);</span><br><span class="line"></span><br><span class="line">    print(&quot;connecting mqtt server&quot;);</span><br><span class="line">    dofile(&quot;mqtt.lua&quot;)</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- Define WiFi station event callbacks </span><br><span class="line">wifi_connect_event = function(T) </span><br><span class="line">  print(&quot;Connection to AP(&quot;..T.SSID..&quot;) established!&quot;)</span><br><span class="line">  print(&quot;Waiting for IP address...&quot;)</span><br><span class="line">  if disconnect_ct ~= nil then disconnect_ct = nil end  </span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">wifi_got_ip_event = function(T) </span><br><span class="line">  -- Note: Having an IP address does not mean there is internet access!</span><br><span class="line">  -- Internet connectivity can be determined with net.dns.resolve().    </span><br><span class="line">  print(&quot;Wifi connection is ready! IP address is: &quot;..T.IP)</span><br><span class="line">  print(&quot;Startup will resume momentarily, you have 3 seconds to abort.&quot;)</span><br><span class="line">  print(&quot;Waiting...&quot;) </span><br><span class="line">  tmr.create():alarm(3000, tmr.ALARM_SINGLE, startup)</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">wifi_disconnect_event = function(T)</span><br><span class="line">  if T.reason == wifi.eventmon.reason.ASSOC_LEAVE then </span><br><span class="line">    --the station has disassociated from a previously connected AP</span><br><span class="line">    return </span><br><span class="line">  end</span><br><span class="line">  -- total_tries: how many times the station will attempt to connect to the AP. Should consider AP reboot duration.</span><br><span class="line">  local total_tries = 5000</span><br><span class="line">  print(&quot;\nWiFi connection to AP(&quot;..T.SSID..&quot;) has failed!&quot;)</span><br><span class="line"></span><br><span class="line">  wifi_connetion1=0;</span><br><span class="line">  </span><br><span class="line">  --There are many possible disconnect reasons, the following iterates through </span><br><span class="line">  --the list and returns the string corresponding to the disconnect reason.</span><br><span class="line">  for key,val in pairs(wifi.eventmon.reason) do</span><br><span class="line">    if val == T.reason then</span><br><span class="line">      print(&quot;Disconnect reason: &quot;..val..&quot;(&quot;..key..&quot;)&quot;)</span><br><span class="line">      break</span><br><span class="line">    end</span><br><span class="line">  end</span><br><span class="line"></span><br><span class="line">  --if disconnect_ct == nil then </span><br><span class="line">--    disconnect_ct = 1 </span><br><span class="line">--  else</span><br><span class="line">    --disconnect_ct = disconnect_ct + 1 </span><br><span class="line">  --end</span><br><span class="line">  --if disconnect_ct &lt; total_tries then </span><br><span class="line">  --  print(&quot;Retrying connection...(attempt &quot;..(disconnect_ct+1)..&quot; of &quot;..total_tries..&quot;)&quot;)</span><br><span class="line">  --else</span><br><span class="line">--    wifi.sta.disconnect()</span><br><span class="line">    --print(&quot;Aborting connection to AP!&quot;)</span><br><span class="line">    --disconnect_ct = nil  </span><br><span class="line">  --end</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">-- Register WiFi Station event callbacks</span><br><span class="line">wifi.eventmon.register(wifi.eventmon.STA_CONNECTED, wifi_connect_event)</span><br><span class="line">wifi.eventmon.register(wifi.eventmon.STA_GOT_IP, wifi_got_ip_event)</span><br><span class="line">wifi.eventmon.register(wifi.eventmon.STA_DISCONNECTED, wifi_disconnect_event)</span><br><span class="line"></span><br><span class="line">print(&quot;Connecting to WiFi access point...&quot;)</span><br><span class="line">wifi.setmode(wifi.STATION)</span><br><span class="line">wifi.sta.config(station_cfg)</span><br><span class="line">wifi.sta.autoconnect(1)</span><br><span class="line">-- wifi.sta.connect() not necessary because config() uses auto-connect=true by default</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dofile(&quot;http.lua&quot;);</span><br><span class="line">print(&quot;runing http&quot;);</span><br><span class="line">dofile(&quot;task.lua&quot;);</span><br><span class="line">print(&quot;runing cron task&quot;);</span><br><span class="line">dofile(&quot;telnet.lua&quot;);</span><br><span class="line">print(&quot;runing telnet server&quot;);</span><br></pre></td></tr></table></figure><p>mqtt.lua</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">function stopReconnect()</span><br><span class="line">    -- clear connecting state and clear connect timer!</span><br><span class="line">    mqtt_connecting = 0</span><br><span class="line">    tmr.stop(3)</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">-- 重连方法</span><br><span class="line">function reconnect()</span><br><span class="line">    if mqtt_connecting == 0 then</span><br><span class="line">        tmr.alarm(3, 20000, 1, function()</span><br><span class="line">            print(&quot;start mqtt server reconnect!&quot;)</span><br><span class="line">            mq:close()</span><br><span class="line">            mq:connect(&quot;x.x.x.x&quot;, 1883, 0)</span><br><span class="line">        end)</span><br><span class="line">        mqtt_connecting = 1</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 初始化mqtt连接方法</span><br><span class="line">function init()</span><br><span class="line">    print(&quot;init mqtt&quot;)</span><br><span class="line">    mqtt_inited = 1</span><br><span class="line">    -- 初始化无需登陆的客户端, 心跳时间 120秒</span><br><span class="line">    mq = mqtt.Client(&quot;recv_earth1&quot;, 120)</span><br><span class="line">    </span><br><span class="line">    --mq:lwt(&quot;/lwt&quot;, &quot;offline&quot;, 0, 0)</span><br><span class="line">    -- 设置连接ip 以及 端口</span><br><span class="line"></span><br><span class="line">    -- 对于 TLS: m:connect(&quot;192.168.11.118&quot;, secure-port, 1)</span><br><span class="line">    mq:connect(&quot;192.168.1.1&quot;, 1883, 0,</span><br><span class="line">    function(client) </span><br><span class="line">        print(&quot;connected&quot;)</span><br><span class="line">    end,</span><br><span class="line">    function(client, reason)</span><br><span class="line">        print(&quot;failed reason: &quot; .. reason)</span><br><span class="line">        reconnect()</span><br><span class="line">    end</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    --连接到服务器触发事件</span><br><span class="line">    mq:on(&quot;connect&quot;,   function(client) </span><br><span class="line">        print(&quot;connected&quot;) </span><br><span class="line">        stopReconnect()</span><br><span class="line">        mq:subscribe(&quot;tai3_water&quot;,0, function(conn) print(&quot;subscribe success&quot;) end)</span><br><span class="line">        --mq:subscribe(&quot;rpt_temp&quot;,0, function(conn) print(&quot;subscribe success&quot;) end)</span><br><span class="line">        </span><br><span class="line">        end) </span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    mq:on(&quot;offline&quot;, function(client)</span><br><span class="line">         print (&quot;offline&quot;)</span><br><span class="line">         reconnect()</span><br><span class="line">         end) --掉线触发事件</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 收到消息时触发事件</span><br><span class="line">mq:on(&quot;message&quot;, function(client, topic, data) </span><br><span class="line">  print(topic .. &quot;:&quot; ) </span><br><span class="line">  if data ~= nil then</span><br><span class="line">     if topic == &quot;tai3_water&quot;  then</span><br><span class="line">        print(data)</span><br><span class="line">        if data == &quot;water1min&quot; then</span><br><span class="line">            dofile(&quot;water.lua&quot;)</span><br><span class="line">            --mq:publish(&quot;report_info&quot;,&quot;tai3_water1&quot;,0,0)</span><br><span class="line">        elseif data == &quot;water2min&quot; then</span><br><span class="line">            dofile(&quot;water2.lua&quot;)</span><br><span class="line">            --mq:publish(&quot;report_info&quot;,&quot;tai3_water2&quot;,0,0)</span><br><span class="line">        elseif data == &quot;water4min&quot; then</span><br><span class="line">            dofile(&quot;water4.lua&quot;)</span><br><span class="line">            --mq:publish(&quot;report_info&quot;,&quot;tai3_water4&quot;,0,0)</span><br><span class="line">        end</span><br><span class="line">     end</span><br><span class="line"></span><br><span class="line">     --if topic == &quot;rpt_water&quot; and tonumber(data) &gt; 12 then</span><br><span class="line">            --print(&quot;aaa&quot;..data)</span><br><span class="line">    --end</span><br><span class="line">     </span><br><span class="line">  end</span><br><span class="line">end)</span><br><span class="line"></span><br><span class="line">end</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--function do_get_adc()  -- 定义定时器处理函数</span><br><span class="line">  --mq:publish(&quot;rpt_water&quot;, adc.read(0), 0, 0) </span><br><span class="line">--end </span><br><span class="line"></span><br><span class="line">--tmr.create():alarm(60000, tmr.ALARM_AUTO , do_get_adc)</span><br><span class="line"></span><br><span class="line">-- 确保subscribe/publish方法在连接上服务器后再调用，在实际应用中是把他们放在connect回调函数里或者确定连接成功</span><br><span class="line"></span><br><span class="line">-- 订阅/topic主题、服务质量为0</span><br><span class="line">--m:subscribe(&quot;topicxx&quot;,0, function(conn) print(&quot;subscribe success&quot;) end)</span><br><span class="line">--m:subscribe(&quot;blinkdr&quot;,0, function(conn) print(&quot;subscribe success&quot;) end)</span><br><span class="line">-- 发送一条信息 data = hello, QoS = 0, retain = 0</span><br><span class="line"></span><br><span class="line">--m:close();</span><br><span class="line">-- 你可以再次调用 m:connect 连接函数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 如果没有初始化过，进行初始化</span><br><span class="line">if mqtt_inited == 0 then</span><br><span class="line">    init()</span><br><span class="line">else</span><br><span class="line">    reconnect()</span><br><span class="line">end</span><br></pre></td></tr></table></figure><p>synctime.lua</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">local tm</span><br><span class="line">local sec</span><br><span class="line"></span><br><span class="line">sec=rtctime.get();</span><br><span class="line">rtctime.set(0);</span><br><span class="line">sntp.sync(&quot;ntp1.aliyun.com&quot;, </span><br><span class="line">    function() -- success</span><br><span class="line">        rtctime.set(rtctime.get() + 8*3600 , 0)</span><br><span class="line">        tm = rtctime.epoch2cal(rtctime.get())  </span><br><span class="line">        print(string.format(&quot;%04d/%02d/%02d %02d:%02d:%02d&quot;, tm[&quot;year&quot;], tm[&quot;mon&quot;], tm[&quot;day&quot;], tm[&quot;hour&quot;], tm[&quot;min&quot;], tm[&quot;sec&quot;]))</span><br><span class="line">    end,</span><br><span class="line">    function() -- fail</span><br><span class="line">        rtctime.set(sec);</span><br><span class="line">        print(&quot;fail!&quot;);</span><br><span class="line">    end</span><br><span class="line"> </span><br><span class="line"> )</span><br></pre></td></tr></table></figure><p>task.lua</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">cron.schedule(&quot;1 5 */2 * *&quot;, function(e)</span><br><span class="line">  dofile(&quot;synctime.lua&quot;);</span><br><span class="line">end)</span><br><span class="line"></span><br><span class="line">--cron.schedule(&quot;*/15 * * * *&quot;, function(e)</span><br><span class="line">--  dofile(&quot;imap_read.lua&quot;);</span><br><span class="line">--end)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cron.schedule(&quot;1 8 * * *&quot;, function(e)</span><br><span class="line">  if mqtt_connecting == 1 then</span><br><span class="line">    dofile(&quot;water2.lua&quot;);</span><br><span class="line">  end</span><br><span class="line">end)</span><br><span class="line"></span><br><span class="line">--cron.schedule(&quot;1 9 * * *&quot;, function(e)</span><br><span class="line">--  dofile(&quot;water.lua&quot;);</span><br><span class="line">--end)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cron.schedule(&quot;1 11 * * *&quot;, function(e)</span><br><span class="line">  if mqtt_connecting == 1 then</span><br><span class="line">    dofile(&quot;water2.lua&quot;);</span><br><span class="line">  end  </span><br><span class="line">end)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--cron.schedule(&quot;1 12 * * *&quot;, function(e)</span><br><span class="line">--  dofile(&quot;water.lua&quot;);</span><br><span class="line">--end)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cron.schedule(&quot;30 17 * * *&quot;, function(e)</span><br><span class="line">  if mqtt_connecting == 1 then</span><br><span class="line">    dofile(&quot;water2.lua&quot;);</span><br><span class="line">  end</span><br><span class="line">end)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--cron.schedule(&quot;30 18 * * *&quot;, function(e)</span><br><span class="line">   --dofile(&quot;water.lua&quot;);</span><br><span class="line">--end)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> nodemcu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nodemcu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ddns 动态更新ip的脚本</title>
      <link href="/2019/08/22/ddns-update-ip-sh/"/>
      <url>/2019/08/22/ddns-update-ip-sh/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line"># check ip change and update it</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ip_regex=&quot;[0-9]\&#123;1,3\&#125;\.[0-9]\&#123;1,3\&#125;\.[0-9]\&#123;1,3\&#125;\.[0-9]\&#123;1,3\&#125;&quot; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ipaddr=$(ifconfig pppoe-wan | awk &apos;/inet /&#123;print $2&#125;&apos; |grep -o &quot;$ip_regex&quot; )</span><br><span class="line"></span><br><span class="line">old_ipaddr=$(ping -c 1 kang.ddns.info|head -1 | grep -o &quot;$ip_regex&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if [ &quot;$ipaddr&quot; != &quot;$old_ipaddr&quot; ];then</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 发邮件</span><br><span class="line">echo &quot;Subject:$ipaddr&quot; | ssmtp -v robot12123@334343.net  </span><br><span class="line"></span><br><span class="line"># 更新</span><br><span class="line">wget -q -O /tmp/ddns --no-check-certificate &apos;https://nic.changeip.com/nic/update?u=XXX&amp;p=XXX&amp;hotname=kk&apos;  </span><br><span class="line">   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fi</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> openwrt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> openwrt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>wr842n_v4.4 烧入 openwrt</title>
      <link href="/2019/08/13/wr842n-v4-openwrt/"/>
      <url>/2019/08/13/wr842n-v4-openwrt/</url>
      
        <content type="html"><![CDATA[<p>wr842n 缩水很严重, 把ram拆下来改成64MB , flash 改成25Q128 16m 版本, 当然,芯片要用编程序写入breed, 然后再焊上去, 结果写入固件后不断重启, 查来查去 ,原来没有烧入art 文件</p><p>art 是无线部分的特性参数的文件,网上做breed的大神有, 我是下载来的,我提供一份把,<a href="/images/art.zip">这里</a> </p><p><a href="https://www.openwrtdl.com/wordpress/arqca-art%e5%a4%a7%e5%90%88%e9%9b%86%e4%b8%8b%e8%bd%bd" target="_blank" rel="noopener">原链接在这里</a></p><p>在breed 中更新qca9533的art文件后,正常启动.</p><p>固件?<br>固件就是opwnwrt 官网固件,我写入是18.XX版本, 我是用来做MTQQ server 的, 所以其他功能没有测试.</p>]]></content>
      
      
      <categories>
          
          <category> openwrt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> openwrt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ssmtp 配置</title>
      <link href="/2019/08/07/ssmtp-conf/"/>
      <url>/2019/08/07/ssmtp-conf/</url>
      
        <content type="html"><![CDATA[<p>ssmtp 是一个简单发邮件工具,</p><p>配置/etc/ssmtp/ssmtp.conf</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"># /etc/ssmtp.conf -- a config file for sSMTP sendmail.</span><br><span class="line">#</span><br><span class="line"></span><br><span class="line"># The person who gets all mail for userids &lt; 1000</span><br><span class="line"># Make this empty to disable rewriting.</span><br><span class="line">root=robot123456@kaudioxxyyzz.net</span><br><span class="line"></span><br><span class="line"># The place where the mail goes. The actual machine name is required</span><br><span class="line"># no MX records are consulted. Commonly mailhosts are named mail.domain.com</span><br><span class="line"># The example will fit if you are in domain.com and your mailhub is so named.</span><br><span class="line">mailhub=smtp.kaudioxxyyzz.net</span><br><span class="line"></span><br><span class="line"># Example for SMTP port number 2525</span><br><span class="line"># mailhub=mail.your.domain:2525</span><br><span class="line"># Example for SMTP port number 25 (Standard/RFC)</span><br><span class="line"># mailhub=mail.your.domain</span><br><span class="line"># Example for SSL encrypted connection</span><br><span class="line"># mailhub=mail.your.domain:465</span><br><span class="line"></span><br><span class="line"># Where will the mail seem to come from?</span><br><span class="line">rewriteDomain=kaudioxxyyzz.net</span><br><span class="line"></span><br><span class="line"># The full hostname</span><br><span class="line">hostname=kaudioxxyyzz.net</span><br><span class="line"></span><br><span class="line"># Set this to never rewrite the &quot;From:&quot; line (unless not given) and to</span><br><span class="line"># use that address in the &quot;from line&quot; of the envelope.</span><br><span class="line">FromLineOverride=YES</span><br><span class="line"></span><br><span class="line"># Use SSL/TLS to send secure messages to server.</span><br><span class="line">#UseTLS=YES</span><br><span class="line"></span><br><span class="line"># Use SSL/TLS certificate to authenticate against smtp host.</span><br><span class="line">#UseTLSCert=YES</span><br><span class="line"></span><br><span class="line"># Use this RSA certificate.</span><br><span class="line">#TLSCert=/etc/ssl/certs/ssmtp.pem</span><br><span class="line"></span><br><span class="line"># Get enhanced (*really* enhanced) debugging information in the logs</span><br><span class="line"># If you want to have debugging of the config file parsing, move this option</span><br><span class="line"># to the top of the config file and uncomment</span><br><span class="line">#Debug=YES</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">AuthUser=robot1234576@kaudioxxyyzz.net</span><br><span class="line">AuthPass=pw</span><br></pre></td></tr></table></figure><p>/etc/ssmtp/revaliases</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># sSMTP aliases</span><br><span class="line">#</span><br><span class="line"># Format:       local_account:outgoing_address:mailhub</span><br><span class="line">#</span><br><span class="line"># Example: root:your_login@your.domain:mailhub.your.domain[:port]</span><br><span class="line"># where [:port] is an optional port number that defaults to 25.</span><br><span class="line"></span><br><span class="line">root:robot1111111@kaudiofdsafasd.net:smtp.kaudioafsdfasdf.net</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> openwrt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> openwrt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>利用阿里云 OpenAPI 以及 DNS 云解析自建 DDNS 运行在路由器之尝试</title>
      <link href="/2019/08/05/aliyun-ddns/"/>
      <url>/2019/08/05/aliyun-ddns/</url>
      
        <content type="html"><![CDATA[<p><a href="https://yq.aliyun.com/articles/712164?spm=a2c4e.11155472.0.0.15213c1eH2kuhC" target="_blank" rel="noopener">原文章在</a></p><p>不过我尝试安装openwrt 路由器上</p><p>首先openwrt 的路由器空间必须大,我是安装在u盘上的,可能要10M左右空间 ,python安装也占不少空间.</p><p>程序中用到阿里云的库, aliyunsdkcore 和aliyunsdkalidns , 之前有人用pip 安装,但是openwrt 上不能, 所以下载其源码,然后解压后, 把里面核心代码复制到 /usr/lib/python2.7/XXXX (后面路径不记得) ,我看见别人自己提取相关几个文件,放在当前目录也可以.</p><p>update_ip.py 这个基本上来自前面那个文章,只不过我因为跑在openwrt上, 所以我改了获取ip的方式,改有get_ip这个脚本获取.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># coding= utf-8</span><br><span class="line"></span><br><span class="line">import subprocess</span><br><span class="line">import os</span><br><span class="line">import json</span><br><span class="line">#from urllib2 import urlopen</span><br><span class="line">from aliyunsdkcore.client import AcsClient</span><br><span class="line">from aliyunsdkcore.acs_exception.exceptions import ClientException</span><br><span class="line">from aliyunsdkcore.acs_exception.exceptions import ServerException</span><br><span class="line">from aliyunsdkalidns.request.v20150109 import DescribeDomainRecordsRequest</span><br><span class="line">from aliyunsdkalidns.request.v20150109 import UpdateDomainRecordRequest</span><br><span class="line"></span><br><span class="line">class DnsHandler:</span><br><span class="line">    # 从阿里云开发者后台获取Access_Key_Id和Access_Key_Secret</span><br><span class="line">    access_key_id = &quot;&quot;</span><br><span class="line">    access_key_secret = &quot;&quot;</span><br><span class="line">    region_id = &quot;cn-hangzhou&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    # 填入自己的域名</span><br><span class="line">    domain_name = &quot;&quot;</span><br><span class="line">    # 填入二级域名的RR值</span><br><span class="line">    rr_keyword = &quot;&quot;</span><br><span class="line"></span><br><span class="line">    # 解析记录类型，一般为A记录</span><br><span class="line">    record_type = &quot;A&quot;</span><br><span class="line"></span><br><span class="line">    # 用于储存解析记录的文件名</span><br><span class="line">    file_name = &quot;.ip_addr&quot;</span><br><span class="line"></span><br><span class="line">    client = None</span><br><span class="line">    record = None</span><br><span class="line">    current_ip  = &apos;&apos;</span><br><span class="line"></span><br><span class="line">    # 初始化，获取client实例</span><br><span class="line">    def __init__(self):</span><br><span class="line">        self.client = AcsClient(</span><br><span class="line">            self.access_key_id,</span><br><span class="line">            self.access_key_secret,</span><br><span class="line">            self.region_id</span><br><span class="line">        )</span><br><span class="line">        self.record = self.get_record()</span><br><span class="line">        self.current_ip = self.get_current_ip()</span><br><span class="line"></span><br><span class="line">    # 如果公网IP发生变化，则自动修改阿里云解析记录</span><br><span class="line">    def reset(self):</span><br><span class="line">        if self.current_ip &lt;&gt; self.get_record_value():</span><br><span class="line">        # print self.current_ip</span><br><span class="line">            print self.update_record(self.current_ip)</span><br><span class="line">            self.get_record()</span><br><span class="line"></span><br><span class="line">    # 获取阿里云域名解析完整记录，并使用文件缓存</span><br><span class="line">    def get_record(self):</span><br><span class="line">        if os.path.isfile(self.file_name) :</span><br><span class="line">            file_handler = open(self.file_name, &apos;r&apos;)</span><br><span class="line">            r = file_handler.read()</span><br><span class="line">            file_handler.close()</span><br><span class="line">        else :</span><br><span class="line">            request = DescribeDomainRecordsRequest.DescribeDomainRecordsRequest()</span><br><span class="line">            request.set_PageSize(10)</span><br><span class="line">            request.set_action_name(&quot;DescribeDomainRecords&quot;)</span><br><span class="line">            request.set_DomainName(self.domain_name)</span><br><span class="line">            request.set_RRKeyWord(self.rr_keyword)</span><br><span class="line">            request.set_TypeKeyWord(self.record_type)</span><br><span class="line">            r = self.client.do_action_with_exception(request)</span><br><span class="line">            file_handler = open(self.file_name, &apos;w&apos;)</span><br><span class="line">            file_handler.write(r)</span><br><span class="line">            file_handler.close()</span><br><span class="line">        return json.loads(r)</span><br><span class="line"></span><br><span class="line">    # 获取阿里云域名解析记录ID</span><br><span class="line">    def get_record_id(self) :</span><br><span class="line">        return self.record[&quot;DomainRecords&quot;][&quot;Record&quot;][0][&quot;RecordId&quot;]</span><br><span class="line"></span><br><span class="line">    # 获取当前域名解析记录</span><br><span class="line">    def get_record_value(self) :</span><br><span class="line">        return self.record[&quot;DomainRecords&quot;][&quot;Record&quot;][0][&quot;Value&quot;]</span><br><span class="line"></span><br><span class="line">    # 修改阿里云解析记录</span><br><span class="line">    def update_record(self, value):</span><br><span class="line">        request = UpdateDomainRecordRequest.UpdateDomainRecordRequest()</span><br><span class="line">        request.set_action_name(&quot;UpdateDomainRecord&quot;)</span><br><span class="line">        request.set_RecordId(self.get_record_id())</span><br><span class="line">        request.set_Type(self.record_type)</span><br><span class="line">        request.set_RR(self.rr_keyword)</span><br><span class="line">        request.set_Value(value)</span><br><span class="line">        return self.client.do_action_with_exception(request)</span><br><span class="line"></span><br><span class="line">    # 获取当前公网IP</span><br><span class="line">    def get_current_ip(self):</span><br><span class="line">        #ip,retcode=os.system(&apos;./get_ip&apos;)</span><br><span class="line">        out_bytes=subprocess.check_output(&apos;/root/get_ip&apos;)</span><br><span class="line">        out_text= out_bytes.decode(&apos;utf8&apos;)</span><br><span class="line">        out_text=out_text.replace(&quot;\n&quot;,&quot;&quot;)</span><br><span class="line">        #print out_text</span><br><span class="line">        #out_text.replace(&quot;\n&quot;,&quot;&quot;).replace(&quot;\r&quot;,&quot;&quot;)</span><br><span class="line">        return out_text</span><br><span class="line">        # //json.load(urlopen(&apos;http://jsonip.com&apos;))[&apos;ip&apos;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 实例化类并启动更新程序</span><br><span class="line">dns = DnsHandler()</span><br><span class="line">dns.reset()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#!/bin/sh</span><br><span class="line"># check ip change and update it</span><br><span class="line"></span><br><span class="line">ip_regex=&quot;[0-9]\&#123;1,3\&#125;\.[0-9]\&#123;1,3\&#125;\.[0-9]\&#123;1,3\&#125;\.[0-9]\&#123;1,3\&#125;&quot; </span><br><span class="line"></span><br><span class="line">ipaddr=$(ifconfig pppoe-wan | awk &apos;/inet /&#123;print $2&#125;&apos;  |grep -o &quot;$ip_regex&quot; )</span><br><span class="line"></span><br><span class="line">echo $ipaddr</span><br></pre></td></tr></table></figure><p>然后加到cron 里面<br>*/15 * * * *  python /root/update_ip.py</p>]]></content>
      
      
      <categories>
          
          <category> openwrt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> openwrt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>rg100a comm run 400mhz</title>
      <link href="/2019/08/05/rg100a-comm/"/>
      <url>/2019/08/05/rg100a-comm/</url>
      
        <content type="html"><![CDATA[<p>1.拆开接上串口，见以前的图，打开串口，重启rg100a，按回车，让其不要启动linux，在cfe控制界面停下来。<br>2.接上网络，登录192.168.1.1.</p><p>3，输入下面中的其中一个用户密码登录进去。</p><p>USER=telecomadmin pass=telecomadmin 2:user=telecomadmin pass=nE7jA%5m 3:user=bjcnchgw pass=8mCnC@bj</p><ol start="4"><li>上次文件，更新系统。在串口哪里，可以看到更新过程，然后自动重启。</li></ol><p><img src="/images/3197274260556595789.jpg" alt="rg100_comm"></p><p>R206，R207，R208，R209各焊上4.7K贴片电阻。成功超频400MHZ</p>]]></content>
      
      
      <categories>
          
          <category> openwrt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> openwrt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Volumio install in Orange Pi Zero</title>
      <link href="/2019/08/01/volumio-orangepizero/"/>
      <url>/2019/08/01/volumio-orangepizero/</url>
      
        <content type="html"><![CDATA[<p>Volumio 没有对应的Zero 的版本,但是又lite 板 ,Lite 是H3 cpu , 和H2 的Zero相比应该是可以运行的, 在volumio的论坛上又lite版的移植</p><p>在这里<a href="https://forum.volumio.org/volumio-orange-boards-t9692.html" target="_blank" rel="noopener">volumio for orangepi</a></p><p><img src="/images/20190801122827.jpg" alt="Orange Pi Zero"><br>烧入SD启动就可以, 设置里面选择I2S-master, 我用的是PCM5102的DA 底噪不明显,示波器看BCK 不稳 , Allwinner 的CPU就这个德行? 怎么做Hifi 啊?? 不知树莓派如何.</p><p>勉强先用.<br><img src="/images/20190801122811.jpg" alt="volumio 运行界面"><br>另外一个要命的问题, volumio是utf8, mount nas的时候也是utf8 .<br>这也算了, ssh登录后台,手动mount cifs -o charset=cp936 竟然不能正常mount, 不知为何.</p><p>所以有些中文文件名无法显示,有些却正常,不知为何, 另外最麻烦的是ape文件中的cue文件,里面全是gb2312的,在volumio里面全部乱码.这怎么用啊?<br><img src="/images/20190801122823.jpg" alt="我的volumio"></p>]]></content>
      
      
      <categories>
          
          <category> 我的作品 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OrangePi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>新的blog</title>
      <link href="/2019/07/31/first-test/"/>
      <url>/2019/07/31/first-test/</url>
      
        <content type="html"><![CDATA[<p>新做的blog 不知道好不好, 先试试, 但是存在一个问题,这个blog 要hexo 支持, 如果在另外一台电脑 , 那不是写不了?</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
